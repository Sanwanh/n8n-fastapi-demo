# å¸‚å ´åˆ†æéƒµä»¶ç³»çµ± - å®Œæ•´æª”æ¡ˆçµæ§‹

## ğŸ“ å°ˆæ¡ˆç›®éŒ„çµæ§‹

```
market_analysis_system/
â”œâ”€â”€ ğŸ“„ main.py                          # ä¸»ç¨‹å¼ (æ›´æ–°ç‰ˆæœ¬)
â”œâ”€â”€ ğŸ“„ config.py                        # ç³»çµ±é…ç½®æª”æ¡ˆ
â”œâ”€â”€ ğŸ“„ models.py                        # è³‡æ–™æ¨¡å‹å®šç¾©
â”œâ”€â”€ ğŸ“„ requirements.txt                 # Python ä¾è³´å¥—ä»¶
â”œâ”€â”€ ğŸ“„ Dockerfile                       # Docker å®¹å™¨é…ç½®
â”œâ”€â”€ ğŸ“„ docker-compose.yml               # Docker Compose é…ç½®
â”œâ”€â”€ ğŸ“„ docker-entrypoint.sh             # Docker å•Ÿå‹•è…³æœ¬
â”œâ”€â”€ ğŸ“„ setup-docker.sh                  # Docker é…ç½®å»ºç«‹è…³æœ¬
â”œâ”€â”€ ğŸ“„ README.md                        # å°ˆæ¡ˆèªªæ˜æ–‡ä»¶
â”œâ”€â”€ ğŸ“ frontend/                        # å‰ç«¯æª”æ¡ˆç›®éŒ„
â”‚   â”œâ”€â”€ ğŸ“„ index.html                   # ä¸»é é¢ (æ›´æ–°ç‰ˆæœ¬)
â”‚   â”œâ”€â”€ ğŸ“„ mail.html                    # éƒµä»¶ç™¼é€é é¢ (æ–°å¢)
â”‚   â””â”€â”€ ğŸ“ static/                      # éœæ…‹è³‡æºç›®éŒ„
â”‚       â”œâ”€â”€ ğŸ“„ style.css                # ä¸»é é¢æ¨£å¼
â”‚       â”œâ”€â”€ ğŸ“„ script.js                # ä¸»é é¢è…³æœ¬
â”‚       â”œâ”€â”€ ğŸ“„ mail-style.css           # éƒµä»¶é é¢æ¨£å¼ (æ–°å¢)
â”‚       â””â”€â”€ ğŸ“„ mail-script.js           # éƒµä»¶é é¢è…³æœ¬ (æ–°å¢)
â”œâ”€â”€ ğŸ“ docker/                          # Docker ç›¸é—œé…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ prometheus.yml               # Prometheus ç›£æ§é…ç½®
â”‚   â””â”€â”€ ğŸ“„ healthcheck.sh               # å¥åº·æª¢æŸ¥è…³æœ¬
â”œâ”€â”€ ğŸ“ logs/                            # æ—¥èªŒæª”æ¡ˆç›®éŒ„
â”‚   â””â”€â”€ ğŸ“„ market_analysis.log          # ç³»çµ±æ—¥èªŒæª”æ¡ˆ
â”œâ”€â”€ ğŸ“ data/                            # è³‡æ–™å„²å­˜ç›®éŒ„
â”œâ”€â”€ ğŸ“ backups/                         # å‚™ä»½æª”æ¡ˆç›®éŒ„
â””â”€â”€ ğŸ“ cache/                           # å¿«å–æª”æ¡ˆç›®éŒ„
```

## ğŸ”„ ä¸»è¦æ›´æ–°å…§å®¹

### 1. æ–°å¢éƒµä»¶ç™¼é€é é¢
- **æª”æ¡ˆ**: `frontend/mail.html`
- **åŠŸèƒ½**: ç¨ç«‹çš„éƒµä»¶ç™¼é€ä»‹é¢
- **ç‰¹è‰²**: 
  - å®Œæ•´çš„è¡¨å–®é©—è­‰
  - å³æ™‚å¸‚å ´æ•¸æ“šé¡¯ç¤º
  - éƒµä»¶é è¦½åŠŸèƒ½
  - å¤šç¨®é…ç½®é¸é …

### 2. éƒµä»¶é é¢æ¨£å¼
- **æª”æ¡ˆ**: `frontend/static/mail-style.css`
- **ç‰¹è‰²**:
  - ç¾ä»£åŒ–è¨­è¨ˆé¢¨æ ¼
  - éŸ¿æ‡‰å¼ä½ˆå±€
  - è±å¯Œçš„å‹•ç•«æ•ˆæœ
  - æ·±è‰²ä¸»é¡Œ

### 3. éƒµä»¶é é¢è…³æœ¬
- **æª”æ¡ˆ**: `frontend/static/mail-script.js`
- **åŠŸèƒ½**:
  - è¡¨å–®è™•ç†èˆ‡é©—è­‰
  - å¸‚å ´æ•¸æ“šè¼‰å…¥
  - éƒµä»¶å…§å®¹ç”Ÿæˆ
  - N8N webhook æ•´åˆ

### 4. æ›´æ–°ä¸»ç¨‹å¼
- **æª”æ¡ˆ**: `main.py`
- **æ–°å¢åŠŸèƒ½**:
  - `/mail` è·¯ç”± - éƒµä»¶ç™¼é€é é¢
  - `/api/send-mail-to-n8n` API - æ–°çš„éƒµä»¶ç™¼é€æ¥å£
  - `/api/test-n8n-connection` API - N8N é€£æ¥æ¸¬è©¦
  - æ”¯æ´æ“´å±•çš„ N8N è³‡æ–™æ ¼å¼

### 5. æ›´æ–°é¦–é 
- **æª”æ¡ˆ**: `frontend/index.html`
- **æ”¹é€²**:
  - æ–°å¢å°èˆªåˆ—
  - éƒµä»¶ç™¼é€é é¢é€£çµ
  - æ›´å¥½çš„ç‹€æ…‹é¡¯ç¤º
  - å¿«é€Ÿæ“ä½œå€åŸŸ

## ğŸ”Œ API ç«¯é»èªªæ˜

### ç¾æœ‰ API (ä¿æŒå‘å¾Œç›¸å®¹)
```
POST /api/n8n-data           # æ¥æ”¶ N8N å¸‚å ´æ•¸æ“š
GET  /api/current-data       # ç²å–ç•¶å‰å¸‚å ´æ•¸æ“š
POST /api/send-email         # èˆŠç‰ˆéƒµä»¶ç™¼é€ API
GET  /health                 # ç³»çµ±å¥åº·æª¢æŸ¥
GET  /api/stats              # ç³»çµ±çµ±è¨ˆè³‡æ–™
GET  /api/test-connection    # æ¸¬è©¦ webhook é€£æ¥
GET  /api/config             # å‰ç«¯é…ç½®è³‡æ–™
```

### æ–°å¢ API
```
GET  /mail                   # éƒµä»¶ç™¼é€é é¢
POST /api/send-mail-to-n8n   # æ–°ç‰ˆéƒµä»¶ç™¼é€ API
GET  /api/test-n8n-connection # æ¸¬è©¦ N8N é€£æ¥
```

## ğŸ“Š N8N è³‡æ–™æ ¼å¼

### è¼¸å…¥è³‡æ–™æ ¼å¼ (å¾ N8N æ¥æ”¶)
```json
{
  "average_sentiment_score": -0.17,
  "message_content": "ä»Šæ—¥å¸‚å ´æ¦‚è¿°ï¼šé»ƒé‡‘æœŸè²¨ç¶­æŒåœ¨çª„å¹…éœ‡ç›ªå€é–“...",
  "market_date": "2025å¹´07æœˆ22æ—¥",
  "confidence_level": "è¼ƒä½",
  "trend_direction": "æº«å’Œçœ‹è·Œ",
  "risk_assessment": "ä½é¢¨éšª"
}
```

### è¼¸å‡ºè³‡æ–™æ ¼å¼ (ç™¼é€åˆ° N8N)
```json
{
  "average_sentiment_score": -0.17,
  "message_content": "ä»Šæ—¥å¸‚å ´æ¦‚è¿°ï¼šé»ƒé‡‘æœŸè²¨ç¶­æŒåœ¨çª„å¹…éœ‡ç›ªå€é–“...",
  "market_date": "2025å¹´07æœˆ22æ—¥",
  "confidence_level": "è¼ƒä½",
  "trend_direction": "æº«å’Œçœ‹è·Œ", 
  "risk_assessment": "ä½é¢¨éšª",
  "received_time": "2025-07-22 00:25:17",
  "mail_config": {
    "recipient_email": "user@example.com",
    "sender_name": "å¸‚å ´åˆ†æç³»çµ±",
    "subject": "å¸‚å ´åˆ†æå ±å‘Š - 2025å¹´07æœˆ22æ—¥",
    "priority": "normal",
    "mail_type": "daily",
    "custom_message": "è‡ªè¨‚å…§å®¹...",
    "include_charts": true,
    "include_recommendations": true,
    "include_risk_warning": true
  },
  "system_info": {
    "send_timestamp": "2025-07-22T00:30:00.000Z",
    "system_version": "1.3.0",
    "source": "mail-sender-page"
  },
  "sentiment_analysis": {
    "score": -0.17,
    "text": "ç•¥ç‚ºæ‚²è§€",
    "emoji": "ğŸ“‰ğŸŸ¡ğŸ˜"
  }
}
```

## ğŸš€ éƒ¨ç½²æŒ‡å—

### æ–¹æ³•ä¸€ï¼šDocker éƒ¨ç½² (æ¨è–¦)
```bash
# 1. ä½¿ç”¨æä¾›çš„ Docker é…ç½®è…³æœ¬
./setup-docker.sh

# 2. å•Ÿå‹•ç³»çµ±
./deploy.sh

# æˆ–ä½¿ç”¨ docker-compose
docker-compose up -d
```

### æ–¹æ³•äºŒï¼šç›´æ¥é‹è¡Œ
```bash
# 1. å®‰è£ä¾è³´
pip install -r requirements.txt

# 2. å•Ÿå‹•ç³»çµ±
python main.py

# æˆ–ä½¿ç”¨ uvicorn
uvicorn main:app --host 0.0.0.0 --port 8089
```

## ğŸ”§ é…ç½®èªªæ˜

### ç’°å¢ƒè®Šæ•¸è¨­å®š
```bash
# åŸºæœ¬é…ç½®
SERVER_HOST=0.0.0.0
SERVER_PORT=8089
DEBUG=false
LOG_LEVEL=INFO

# Webhook é…ç½®
WEBHOOK_URL=https://beloved-swine-sensibly.ngrok-free.app/webhook-test/ef5ac185-f41a-4a2d-9a78-33d329184c2
WEBHOOK_TIMEOUT=30

# N8N Webhook (æ–°å¢)
N8N_WEBHOOK_URL=https://beloved-swine-sensibly.ngrok-free.app/webhook/Webhook%20-%20Preview

# å®‰å…¨é…ç½®
API_KEY=your_api_key_here
CORS_ORIGINS=*
```

### é‡è¦é…ç½®é …ç›®
- **WEBHOOK_URL**: èˆŠç‰ˆ webhook ç«¯é» (ä¿æŒå‘å¾Œç›¸å®¹)
- **N8N_WEBHOOK_URL**: æ–°ç‰ˆ N8N webhook ç«¯é» (éƒµä»¶ç™¼é€é é¢ä½¿ç”¨)
- **SERVER_PORT**: ç³»çµ±é‹è¡Œç«¯å£ (é è¨­: 8089)
- **DEBUG**: é™¤éŒ¯æ¨¡å¼é–‹é—œ

## ğŸ“± ä½¿ç”¨èªªæ˜

### 1. é¦–é åŠŸèƒ½
- è¨ªå• `http://localhost:8089/`
- æŸ¥çœ‹ç³»çµ±ç‹€æ…‹å’Œç•¶å‰å¸‚å ´æ•¸æ“š
- å¿«é€Ÿå°èˆªåˆ°å„åŠŸèƒ½é é¢

### 2. éƒµä»¶ç™¼é€é é¢
- è¨ªå• `http://localhost:8089/mail`
- é…ç½®éƒµä»¶ç›¸é—œè¨­å®š
- é è¦½éƒµä»¶å…§å®¹
- ç™¼é€åˆ° N8N webhook

### 3. API ä½¿ç”¨
```bash
# æŸ¥çœ‹ API æ–‡æª”
curl http://localhost:8089/docs

# ç²å–ç•¶å‰æ•¸æ“š
curl http://localhost:8089/api/current-data

# æ¸¬è©¦ N8N é€£æ¥
curl http://localhost:8089/api/test-n8n-connection

# å¥åº·æª¢æŸ¥
curl http://localhost:8089/health
```

## ğŸ”„ è³‡æ–™æµç¨‹

```
N8N å·¥ä½œæµç¨‹ 
    â†“ (POST /api/n8n-data)
ç³»çµ±æ¥æ”¶ä¸¦å„²å­˜å¸‚å ´æ•¸æ“š
    â†“
ä½¿ç”¨è€…åœ¨éƒµä»¶é é¢é…ç½®éƒµä»¶
    â†“ (POST /api/send-mail-to-n8n)
ç³»çµ±æ•´åˆæ•¸æ“šä¸¦ç™¼é€åˆ° N8N
    â†“ (POST webhook/Webhook - Preview)
N8N è™•ç†éƒµä»¶ç™¼é€
    â†“
éƒµä»¶ç™¼é€åˆ°æ”¶ä»¶äºº
```

## ğŸ› ï¸ é–‹ç™¼æŒ‡å—

### æ–°å¢åŠŸèƒ½æ­¥é©Ÿ
1. **å¾Œç«¯ API**: åœ¨ `main.py` ä¸­æ–°å¢è·¯ç”±
2. **å‰ç«¯é é¢**: åœ¨ `frontend/` ç›®éŒ„å»ºç«‹ HTML
3. **æ¨£å¼è¨­è¨ˆ**: åœ¨ `frontend/static/` å»ºç«‹ CSS
4. **äº’å‹•åŠŸèƒ½**: åœ¨ `frontend/static/` å»ºç«‹ JS
5. **é…ç½®æ›´æ–°**: æ›´æ–° `config.py` ç›¸é—œè¨­å®š

### ç¨‹å¼ç¢¼çµæ§‹
- **main.py**: FastAPI æ‡‰ç”¨ä¸»é«”
- **config.py**: ç³»çµ±é…ç½®ç®¡ç†
- **models.py**: è³‡æ–™æ¨¡å‹å®šç¾©
- **frontend/**: å‰ç«¯æª”æ¡ˆ
- **static/**: éœæ…‹è³‡æº

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ
1. **éƒµä»¶ç™¼é€å¤±æ•—**
   - æª¢æŸ¥ N8N webhook URL æ˜¯å¦æ­£ç¢º
   - ç¢ºèªç¶²è·¯é€£æ¥æ­£å¸¸
   - æŸ¥çœ‹ç³»çµ±æ—¥èªŒ `logs/market_analysis.log`

2. **å¸‚å ´æ•¸æ“šæœªé¡¯ç¤º**
   - ç¢ºèª N8N å·¥ä½œæµç¨‹æ­£å¸¸é‹è¡Œ
   - æª¢æŸ¥è³‡æ–™æ ¼å¼æ˜¯å¦ç¬¦åˆé æœŸ
   - ä½¿ç”¨ `/api/current-data` æª¢æŸ¥åŸå§‹æ•¸æ“š

3. **ç³»çµ±ç„¡æ³•å•Ÿå‹•**
   - æª¢æŸ¥ç«¯å£ 8089 æ˜¯å¦è¢«ä½”ç”¨
   - ç¢ºèª Python ä¾è³´å·²æ­£ç¢ºå®‰è£
   - æŸ¥çœ‹å•Ÿå‹•æ—¥èªŒ

### æ—¥èªŒæª¢æŸ¥
```bash
# æŸ¥çœ‹ç³»çµ±æ—¥èªŒ
tail -f logs/market_analysis.log

# æŸ¥çœ‹ Docker æ—¥èªŒ
docker-compose logs -f market-analysis
```

## ğŸ“‹ æª¢æŸ¥æ¸…å–®

### éƒ¨ç½²å‰æª¢æŸ¥
- [ ] å·²å®‰è£æ‰€æœ‰ä¾è³´å¥—ä»¶
- [ ] é…ç½®æª”æ¡ˆè¨­å®šæ­£ç¢º
- [ ] N8N webhook URL å¯è¨ªå•
- [ ] ç«¯å£ 8089 æœªè¢«ä½”ç”¨
- [ ] æ—¥èªŒç›®éŒ„æœ‰å¯«å…¥æ¬Šé™

### åŠŸèƒ½æ¸¬è©¦æª¢æŸ¥
- [ ] é¦–é æ­£å¸¸è¼‰å…¥ä¸¦é¡¯ç¤ºç‹€æ…‹
- [ ] éƒµä»¶é é¢å¯æ­£å¸¸è¨ªå•
- [ ] å¯ä»¥æ¥æ”¶ N8N å¸‚å ´æ•¸æ“š
- [ ] éƒµä»¶ç™¼é€åŠŸèƒ½æ­£å¸¸
- [ ] API æ–‡æª”å¯æ­£å¸¸è¨ªå•
- [ ] å¥åº·æª¢æŸ¥å›æ‡‰æ­£å¸¸

## ğŸ”® æœªä¾†æ“´å±•

### è¨ˆç•«åŠŸèƒ½
- [ ] ä½¿ç”¨è€…å¸³æˆ¶ç®¡ç†
- [ ] éƒµä»¶ç¯„æœ¬è‡ªå®šç¾©
- [ ] æ­·å²æ•¸æ“šæŸ¥è©¢
- [ ] é€²éšåˆ†æåœ–è¡¨
- [ ] æ’ç¨‹éƒµä»¶ç™¼é€
- [ ] å¤šèªè¨€æ”¯æ´

### æŠ€è¡“æ”¹é€²
- [ ] è³‡æ–™åº«æ•´åˆ (PostgreSQL/MongoDB)
- [ ] Redis å¿«å–å±¤
- [ ] è¨Šæ¯ä½‡åˆ— (Celery)
- [ ] ç›£æ§å„€è¡¨æ¿ (Grafana)
- [ ] å–®å…ƒæ¸¬è©¦è¦†è“‹
- [ ] CI/CD æµç¨‹

## ğŸ“ è¯çµ¡è³‡è¨Š

å¦‚æœ‰ä»»ä½•å•é¡Œæˆ–å»ºè­°ï¼Œè«‹ï¼š
1. æŸ¥çœ‹ç³»çµ±æ—¥èªŒæª”æ¡ˆ
2. æª¢æŸ¥ GitHub Issues (å¦‚æœæœ‰çš„è©±)
3. è¯ç¹«ç³»çµ±ç®¡ç†å“¡

---

**ç‰ˆæœ¬**: 1.3.0  
**æœ€å¾Œæ›´æ–°**: 2025-07-22