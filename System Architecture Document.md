# 市場分析報告系統需求書

# 1. 系統名稱

**市場分析報告系統 (Market Analysis Report System, MARS)**

# 2. 系統目的與範圍

## 2.1 系統開發目的
本系統旨在建立一個智能化的市場分析平台，整合即時黃金價格監控、情感分析、技術指標計算和自動化郵件報告功能。系統透過 N8N 工作流程整合，提供完整的市場數據分析解決方案，協助用戶進行投資決策和市場趨勢分析。

## 2.2 功能涵蓋範圍
- **即時數據監控**：整合 yfinance API 獲取黃金期貨價格數據
- **技術分析**：提供 RSI、移動平均線、黃金交叉/死亡交叉等技術指標
- **情感分析**：透過 N8N 工作流程進行市場情感分析
- **視覺化展示**：使用 Chart.js 提供互動式價格圖表
- **自動化報告**：支援郵件發送功能，可自訂報告內容
- **Webhook 整合**：與 N8N 平台深度整合，支援自動化工作流程
- **容器化部署**：支援 Docker 容器化部署，便於環境管理

# 3. 系統非功能需求

| 非功能需求編號 | 非功能需求描述 |
|----------------|----------------|
| MARS-NF-001 | **效能需求**：系統應能在 3 秒內回應 API 請求，圖表載入時間不超過 5 秒 |
| MARS-NF-002 | **可用性需求**：系統可用性應達到 99.5%，支援 7x24 小時運行 |
| MARS-NF-003 | **安全性需求**：所有 API 端點應具備適當的錯誤處理，防止敏感數據洩露 |
| MARS-NF-004 | **可擴展性需求**：系統架構應支援水平擴展，可處理並發用戶訪問 |
| MARS-NF-005 | **相容性需求**：支援主流瀏覽器（Chrome、Firefox、Safari、Edge） |
| MARS-NF-006 | **響應式設計**：前端界面應支援桌面、平板和手機設備 |
| MARS-NF-007 | **日誌記錄**：系統應記錄詳細的操作日誌，便於問題追蹤和監控 |
| MARS-NF-008 | **數據持久化**：重要數據應進行本地存儲和備份 |

# 4. 系統功能需求

| 功能需求編號 | 功能需求描述 |
|--------------|--------------|
| MARS-F-001 | **即時黃金價格監控**：系統應能從 yfinance API 獲取即時黃金期貨價格數據 |
| MARS-F-002 | **技術指標計算**：系統應能計算 RSI、移動平均線（MA5、MA20、MA50、MA125）等技術指標 |
| MARS-F-003 | **圖表視覺化**：系統應提供互動式價格圖表，支援多種時間週期顯示 |
| MARS-F-004 | **情感分析整合**：系統應能接收和處理 N8N 工作流程的情感分析結果 |
| MARS-F-005 | **郵件發送功能**：系統應支援自訂郵件內容和收件人，發送市場分析報告 |
| MARS-F-006 | **Webhook 接收**：系統應能接收來自 N8N 的 Webhook 數據 |
| MARS-F-007 | **數據統計分析**：系統應提供黃金價格的統計分析功能 |
| MARS-F-008 | **市場狀態判斷**：系統應能根據技術指標判斷市場趨勢和狀態 |
| MARS-F-009 | **API 文檔**：系統應提供自動生成的 API 文檔 |
| MARS-F-010 | **健康檢查**：系統應提供健康檢查端點，監控系統狀態 |
| MARS-F-011 | **錯誤處理**：系統應具備完善的錯誤處理機制 |
| MARS-F-012 | **配置管理**：系統應支援環境變數配置，便於不同環境部署 |

# 5. 使用案例劇本 (Use Case Scenarios)

## 使用案例編號：`MARS-UC001`  
**使用案例名稱：** 查看即時黃金價格和技術分析

| 系統反應動作 | 使用者操作動作 |
|---------------|----------------|
| a. 系統載入主頁面，顯示導航欄和系統時間 | b. 用戶訪問系統首頁 |
| c. 系統從 yfinance API 獲取黃金價格數據 | d. 用戶點擊"刷新數據"按鈕 |
| e. 系統計算技術指標（RSI、移動平均線等） | f. 用戶選擇不同的時間週期（1日、1週、1月、1年） |
| g. 系統生成互動式價格圖表，顯示價格趨勢和技術指標 | h. 用戶查看圖表並分析市場趨勢 |
| i. 系統顯示市場狀態和統計信息 | j. 用戶查看市場分析報告 |

---

## 使用案例編號：`MARS-UC002`  
**使用案例名稱：** 發送市場分析郵件報告

| 系統反應動作 | 使用者操作動作 |
|---------------|----------------|
| a. 系統載入郵件發送頁面，顯示市場數據預覽 | b. 用戶點擊導航欄中的"郵件發送"連結 |
| c. 系統載入當前市場數據並顯示在預覽區域 | d. 用戶填寫收件人郵件地址 |
| e. 系統驗證郵件格式的正確性 | f. 用戶輸入自訂訊息內容（可選） |
| g. 系統準備郵件內容，包含市場數據和分析 | h. 用戶點擊"發送郵件"按鈕 |
| i. 系統透過 N8N Webhook 發送郵件 | j. 用戶查看發送結果和狀態 |
| k. 系統顯示發送成功或失敗的訊息 | l. 用戶確認郵件發送狀態 |

---

## 使用案例編號：`MARS-UC003`  
**使用案例名稱：** 接收 N8N 情感分析數據

| 系統反應動作 | 使用者操作動作 |
|---------------|----------------|
| a. 系統監聽 Webhook 端點，等待 N8N 數據 | b. N8N 工作流程執行情感分析 |
| c. 系統接收來自 N8N 的 Webhook 請求 | d. N8N 發送包含情感分析結果的數據 |
| e. 系統驗證接收到的數據格式和內容 | f. 系統處理情感分析數據 |
| g. 系統將情感分析結果與市場數據整合 | h. 系統更新顯示的情感分析信息 |
| i. 系統記錄接收到的數據到日誌檔案 | j. 系統在界面上顯示最新的情感分析結果 |

---

## 使用案例編號：`MARS-UC004`  
**使用案例名稱：** 系統監控和健康檢查

| 系統反應動作 | 使用者操作動作 |
|---------------|----------------|
| a. 系統定期執行健康檢查，監控各組件狀態 | b. 管理員訪問健康檢查端點 |
| c. 系統檢查 API 連接、數據庫連接等服務狀態 | d. 管理員查看系統日誌檔案 |
| e. 系統記錄系統運行狀態和錯誤信息 | f. 管理員檢查系統資源使用情況 |
| g. 系統提供 API 文檔頁面供開發者參考 | h. 管理員查看 API 文檔 |
| i. 系統顯示系統版本和配置信息 | j. 管理員進行系統維護和更新 |

---

## 使用案例編號：`MARS-UC005`  
**使用案例名稱：** Docker 容器化部署

| 系統反應動作 | 使用者操作動作 |
|---------------|----------------|
| a. 系統讀取 Docker 配置檔案 | b. 管理員執行 docker-compose up 命令 |
| c. 系統建立容器網絡和數據卷 | d. 管理員設定環境變數 |
| e. 系統啟動 FastAPI 應用服務 | f. 管理員檢查容器運行狀態 |
| g. 系統啟動 ngrok 服務（可選） | g. 管理員查看服務日誌 |
| h. 系統啟動 Redis 快取服務（可選） | h. 管理員進行服務擴展 |
| i. 系統啟動監控服務（可選） | i. 管理員進行系統備份 |
| j. 系統提供健康檢查和監控端點 | j. 管理員進行系統維護 |

---

## 系統架構總結

本系統採用現代化的微服務架構，主要包含以下核心組件：

1. **FastAPI 後端服務**：提供 RESTful API 和 Web 界面
2. **前端界面**：響應式 Web 界面，支援多設備訪問
3. **數據處理模組**：處理金融數據和技術指標計算
4. **N8N 整合模組**：與 N8N 工作流程平台深度整合
5. **郵件發送模組**：支援自動化郵件報告功能
6. **容器化部署**：支援 Docker 和 docker-compose 部署
7. **監控和日誌**：完整的系統監控和日誌記錄功能

系統設計注重可擴展性、可維護性和用戶體驗，為市場分析提供完整的解決方案。
