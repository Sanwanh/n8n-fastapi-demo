<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>市場分析郵件發送系統</title>
    <link rel="stylesheet" href="/static/mail-style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="background-animation">
        <div class="floating-shape shape-1"></div>
        <div class="floating-shape shape-2"></div>
        <div class="floating-shape shape-3"></div>
    </div>

    <div class="container">
        <!-- 導航列 -->
        <nav class="navigation">
            <div class="nav-brand">
                <i class="fas fa-envelope-open-text"></i>
                <span>郵件發送系統</span>
            </div>
            <div class="nav-links">
                <a href="/" class="nav-link">
                    <i class="fas fa-home"></i>
                    返回首頁
                </a>
                <div class="system-time" id="system-time">
                    <i class="fas fa-clock"></i>
                    <span id="current-time">--:--:--</span>
                </div>
            </div>
        </nav>

        <!-- 標題區域 -->
        <header class="page-header">
            <div class="header-icon">
                <i class="fas fa-paper-plane"></i>
            </div>
            <h1>市場分析郵件發送</h1>
            <p>將最新市場分析數據通過郵件發送給指定收件人</p>
            <div class="last-updated" id="last-updated">
                <i class="fas fa-sync"></i>
                <span>數據更新: --</span>
            </div>
        </header>

        <!-- 主要內容 -->
        <div class="main-content">
            <!-- 市場數據預覽卡片 -->
            <div class="card data-preview-card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h2>市場數據預覽</h2>
                    <div class="status-indicator" id="status-indicator">
                        <span class="indicator-dot"></span>
                        <span class="indicator-text">載入中...</span>
                    </div>
                </div>
                <div class="card-content">
                    <div id="market-data-display">
                        <div class="loading-spinner">
                            <div class="spinner"></div>
                            <span>正在載入市場數據...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 郵件配置卡片 -->
            <div class="card mail-form-card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <h2>郵件設定與發送</h2>
                    <div class="form-progress" id="form-progress">
                        <div class="progress-step active" data-step="1">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="progress-step" data-step="2">
                            <i class="fas fa-edit"></i>
                        </div>
                        <div class="progress-step" data-step="3">
                            <i class="fas fa-cog"></i>
                        </div>
                        <div class="progress-step" data-step="4">
                            <i class="fas fa-paper-plane"></i>
                        </div>
                    </div>
                </div>
                <div class="card-content">
                    <form id="mail-form" class="mail-form">
                        <!-- 步驟 1: 基本資訊 -->
                        <div class="form-step active" data-step="1">
                            <div class="step-header">
                                <h3><i class="fas fa-user"></i> 收件人資訊</h3>
                                <p>請輸入郵件收件人的基本資訊</p>
                            </div>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="recipient">
                                        <i class="fas fa-envelope"></i>
                                        收件人郵件地址 *
                                    </label>
                                    <input type="email" id="recipient" name="recipient"
                                           placeholder="example@email.com" required>
                                    <div class="input-hint">請輸入有效的郵件地址</div>
                                </div>

                                <div class="form-group">
                                    <label for="sender_name">
                                        <i class="fas fa-signature"></i>
                                        寄件人名稱
                                    </label>
                                    <input type="text" id="sender_name" name="sender_name"
                                           value="市場分析系統" placeholder="請輸入寄件人名稱">
                                    <div class="input-hint">將顯示在郵件中的發送者名稱</div>
                                </div>
                            </div>
                        </div>

                        <!-- 步驟 2: 郵件內容 -->
                        <div class="form-step" data-step="2">
                            <div class="step-header">
                                <h3><i class="fas fa-edit"></i> 郵件內容</h3>
                                <p>設定郵件主題和自訂內容</p>
                            </div>
                            <div class="form-grid">
                                <div class="form-group full-width">
                                    <label for="subject">
                                        <i class="fas fa-heading"></i>
                                        郵件主旨 *
                                    </label>
                                    <input type="text" id="subject" name="subject"
                                           value="市場分析報告" placeholder="請輸入郵件主旨">
                                    <div class="input-hint">建議包含日期或時間範圍</div>
                                </div>

                                <div class="form-group full-width">
                                    <label for="custom_message">
                                        <i class="fas fa-comment-alt"></i>
                                        自訂開頭訊息 <span class="optional">(選填)</span>
                                    </label>
                                    <textarea id="custom_message" name="custom_message" rows="4"
                                             placeholder="請輸入您想要添加到郵件開頭的自訂內容..."></textarea>
                                    <div class="input-hint">此訊息將顯示在市場分析內容之前</div>
                                </div>

                                <div class="form-group full-width">
                                    <label for="mail_type">
                                        <i class="fas fa-tag"></i>
                                        郵件類型
                                    </label>
                                    <select id="mail_type" name="mail_type" class="form-select">
                                        <option value="daily">每日報告</option>
                                        <option value="weekly">週度報告</option>
                                        <option value="monthly">月度報告</option>
                                        <option value="alert">市場警示</option>
                                        <option value="custom">自訂報告</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- 步驟 3: 郵件選項 -->
                        <div class="form-step" data-step="3">
                            <div class="step-header">
                                <h3><i class="fas fa-cog"></i> 郵件選項</h3>
                                <p>選擇要包含在郵件中的額外內容</p>
                            </div>
                            <div class="options-section">
                                <div class="option-category">
                                    <h4>內容選項</h4>
                                    <div class="options-grid">
                                        <div class="checkbox-group">
                                            <input type="checkbox" id="include_charts" name="include_charts" checked>
                                            <label for="include_charts">
                                                <span class="checkbox-mark">
                                                    <i class="fas fa-check"></i>
                                                </span>
                                                <span class="checkbox-content">
                                                    <strong><i class="fas fa-chart-bar"></i> 包含圖表分析</strong>
                                                    <small>在郵件中附加視覺化圖表和技術分析</small>
                                                </span>
                                            </label>
                                        </div>

                                        <div class="checkbox-group">
                                            <input type="checkbox" id="include_recommendations" name="include_recommendations" checked>
                                            <label for="include_recommendations">
                                                <span class="checkbox-mark">
                                                    <i class="fas fa-check"></i>
                                                </span>
                                                <span class="checkbox-content">
                                                    <strong><i class="fas fa-lightbulb"></i> 包含投資建議</strong>
                                                    <small>基於當前市場分析提供相應投資建議</small>
                                                </span>
                                            </label>
                                        </div>

                                        <div class="checkbox-group">
                                            <input type="checkbox" id="include_risk_warning" name="include_risk_warning" checked>
                                            <label for="include_risk_warning">
                                                <span class="checkbox-mark">
                                                    <i class="fas fa-check"></i>
                                                </span>
                                                <span class="checkbox-content">
                                                    <strong><i class="fas fa-exclamation-triangle"></i> 包含風險提醒</strong>
                                                    <small>添加風險評估和投資注意事項</small>
                                                </span>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div class="option-category">
                                    <h4>郵件優先級</h4>
                                    <div class="priority-options">
                                        <div class="radio-group">
                                            <input type="radio" id="priority_low" name="priority" value="low">
                                            <label for="priority_low">
                                                <i class="fas fa-arrow-down priority-icon low"></i>
                                                <span>低優先級</span>
                                            </label>
                                        </div>
                                        <div class="radio-group">
                                            <input type="radio" id="priority_normal" name="priority" value="normal" checked>
                                            <label for="priority_normal">
                                                <i class="fas fa-minus priority-icon normal"></i>
                                                <span>一般</span>
                                            </label>
                                        </div>
                                        <div class="radio-group">
                                            <input type="radio" id="priority_high" name="priority" value="high">
                                            <label for="priority_high">
                                                <i class="fas fa-exclamation priority-icon high"></i>
                                                <span>高優先級</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 步驟 4: 預覽與發送 -->
                        <div class="form-step" data-step="4">
                            <div class="step-header">
                                <h3><i class="fas fa-paper-plane"></i> 預覽與發送</h3>
                                <p>確認郵件內容並發送</p>
                            </div>
                            <div class="preview-section">
                                <div class="email-preview" id="email-preview">
                                    <div class="preview-header">
                                        <h4><i class="fas fa-envelope"></i> 郵件預覽</h4>
                                        <button type="button" class="preview-refresh-btn" onclick="generatePreview()">
                                            <i class="fas fa-sync"></i> 刷新預覽
                                        </button>
                                    </div>
                                    <div class="preview-content" id="preview-content">
                                        <div class="loading-spinner">
                                            <div class="spinner"></div>
                                            <span>生成預覽中...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 表單導航 -->
                        <div class="form-navigation">
                            <button type="button" id="prev-btn" class="nav-btn secondary" style="display: none;">
                                <i class="fas fa-arrow-left"></i>
                                <span>上一步</span>
                            </button>
                            <div class="step-info">
                                <span class="step-current">1</span>
                                <span class="step-separator">/</span>
                                <span class="step-total">4</span>
                            </div>
                            <button type="button" id="next-btn" class="nav-btn primary">
                                <span>下一步</span>
                                <i class="fas fa-arrow-right"></i>
                            </button>
                            <button type="submit" id="send-btn" class="nav-btn success" style="display: none;" disabled>
                                <span class="btn-icon">
                                    <i class="fas fa-paper-plane"></i>
                                </span>
                                <span class="btn-text">發送郵件</span>
                                <div class="btn-loading">
                                    <i class="fas fa-spinner fa-spin"></i>
                                </div>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- 結果模態框 -->
        <div class="modal" id="result-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-icon" id="result-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h3 id="result-title">發送成功</h3>
                    <button class="modal-close" id="result-close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div id="result-message">郵件已成功發送！</div>
                    <div id="result-details"></div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" id="result-ok">確定</button>
                    <button class="btn btn-secondary" id="send-another">再發一封</button>
                </div>
            </div>
        </div>

        <!-- 頁腳 -->
        <footer class="page-footer">
            <div class="footer-content">
                <div class="footer-info">
                    <h3>市場分析郵件系統</h3>
                    <p>專業的市場分析報告郵件發送服務</p>
                </div>
                <div class="footer-stats">
                    <div class="stat-item">
                        <span class="stat-label">系統狀態</span>
                        <span class="stat-value" id="system-status">正常運行</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">版本</span>
                        <span class="stat-value">v2.1.0</span>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script src="/static/mail-script.js"></script>
</body>
</html>