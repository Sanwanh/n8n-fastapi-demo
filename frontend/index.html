<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸‚å ´åˆ†æå ±å‘Šç³»çµ± - å³æ™‚é»ƒé‡‘åƒ¹æ ¼</title>
    <link rel="icon" type="image/x-icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“ˆ</text></svg>">
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chartjs-adapter-moment.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/2.1.0/chartjs-plugin-annotation.min.js"></script>
    <script>
        // ç¢ºä¿è¨»è§£æ’ä»¶æ­£ç¢ºè¼‰å…¥
        if (typeof Chart !== 'undefined') {
            console.log('âœ… Chart.js å·²è¼‰å…¥');
            console.log('Chart.js ç‰ˆæœ¬:', Chart.version);
        }
        // æª¢æŸ¥è¨»è§£æ’ä»¶æ˜¯å¦æ­£ç¢ºè¼‰å…¥
        if (typeof Chart !== 'undefined' && Chart.registry && Chart.registry.getController) {
            console.log('âœ… Chart.js è¨»è§£æ’ä»¶å·²è¼‰å…¥');
        } else {
            console.warn('âš ï¸ Chart.js è¨»è§£æ’ä»¶æœªè¼‰å…¥');
        }
    </script>
    <script>
        // ç¢ºä¿ Chart.js æ™‚é–“é©é…å™¨æ­£ç¢ºè¼‰å…¥
        if (typeof Chart !== 'undefined') {
            Chart.defaults.locale = 'zh-TW';
        }
    </script>
</head>

<body>
    <div class="background-animation">
        <div class="floating-shape shape-1"></div>
        <div class="floating-shape shape-2"></div>
        <div class="floating-shape shape-3"></div>
        <div class="floating-shape shape-4"></div>
        <div class="floating-shape shape-5"></div>
    </div>

    <div class="container">
        <nav class="navigation">
            <div class="nav-brand">
                <div class="brand-logo">
                    <span class="logo-emoji">ğŸ“ˆ</span>
                </div>
                <span>å¸‚å ´åˆ†æç³»çµ±</span>
            </div>
            <div class="nav-links">
                <a href="/mail" class="nav-link mail-link">
                    <i class="fas fa-envelope"></i>
                    éƒµä»¶ç™¼é€
                </a>
                <a href="/api/docs" class="nav-link docs-link" target="_blank">
                    <i class="fas fa-book"></i>
                    API æ–‡æª”
                </a>
                <div class="system-time" id="system-time">
                    <i class="fas fa-clock"></i>
                    <span id="current-time">--:--:--</span>
                </div>
            </div>
        </nav>

        <header class="page-header">
            <div class="header-icon">
                <div class="header-logo">
                    <span class="header-emoji">ğŸ“ˆ</span>
                </div>
            </div>
            <h1>å¸‚å ´åˆ†æå ±å‘Šç³»çµ±</h1>
            <p>æ™ºèƒ½æƒ…æ„Ÿåˆ†æ â€¢ å³æ™‚é»ƒé‡‘åƒ¹æ ¼ â€¢ è‡ªå‹•åŒ–å ±å‘Š</p>
        </header>

        <div class="main-layout">
            <!-- å·¦é‚Šå¿«é€Ÿæ“ä½œæ¬„ä½ -->
            <div class="sidebar">
                <div class="quick-actions-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-rocket"></i>
                        </div>
                        <h3>å¿«é€Ÿæ“ä½œ</h3>
                    </div>
                    <div class="card-content">
                        <div class="action-buttons-vertical">
                            <a href="/mail" class="action-btn primary">
                                <i class="fas fa-paper-plane"></i>
                                <span>ç™¼é€éƒµä»¶å ±å‘Š</span>
                            </a>
                            <button onclick="refreshAllData()" class="action-btn secondary" id="refresh-btn">
                                <i class="fas fa-sync"></i>
                                <span>åˆ·æ–°æ•¸æ“š</span>
                            </button>
                            <button onclick="scrollToSentiment()" class="action-btn info">
                                <i class="fas fa-brain"></i>
                                <span>å¸‚å ´æƒ…æ„Ÿåˆ†æ</span>
                            </button>
                            <button onclick="scrollToGoldPrice()" class="action-btn gold">
                                <i class="fas fa-coins"></i>
                                <span>é»ƒé‡‘æœŸè²¨åƒ¹æ ¼</span>
                            </button>
                            <button onclick="scrollToDataDetails()" class="action-btn secondary"
                                id="quick-details-toggle">
                                <i class="fas fa-database"></i>
                                <span>è©³ç´°æ•¸æ“šæ—¥èªŒ</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä¸»è¦å…§å®¹å€åŸŸ -->
            <div class="main-content">
                <!-- å¸‚å ´æƒ…æ„Ÿåˆ†æå¡ç‰‡ -->
                <div class="card data-card" id="sentiment-section">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-brain"></i>
                        </div>
                        <h2>å¸‚å ´æƒ…æ„Ÿåˆ†æ</h2>
                        <div class="status-indicator" id="status-indicator">
                            <span class="indicator-dot"></span>
                            <span class="indicator-text">è¼‰å…¥ä¸­...</span>
                        </div>
                    </div>
                    <div class="card-content">
                        <div id="market-data-display">
                            <div class="loading-spinner">
                                <div class="spinner"></div>
                                <span>æ­£åœ¨è¼‰å…¥å¸‚å ´æ•¸æ“š...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- é»ƒé‡‘åƒ¹æ ¼å¡ç‰‡ -->
                <div class="card gold-price-card" id="gold-price-section">
                    <div class="card-header">
                        <div class="card-icon gold-icon">
                            <i class="fas fa-coins"></i>
                        </div>
                        <h2>é»ƒé‡‘æœŸè²¨åƒ¹æ ¼ (GC=F)</h2>
                        <div class="price-controls">
                            <div class="price-status" id="price-status">
                                <span class="status-dot"></span>
                                <span class="status-text">è¼‰å…¥ä¸­...</span>
                            </div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="price-display" id="price-display">
                            <div class="loading-spinner">
                                <div class="spinner"></div>
                                <span>æ­£åœ¨è¼‰å…¥é»ƒé‡‘åƒ¹æ ¼...</span>
                            </div>
                        </div>

                        <div id="gold-last-updated" class="last-updated"
                            style="text-align: right; margin-top: 1rem; font-size: 0.9em; color: var(--text-muted);">
                            <i class="fas fa-sync"></i>
                            <span>--</span>
                        </div>

                        <div class="technical-indicators" id="technical-indicators" style="display: block;">
                            <h3><i class="fas fa-chart-line"></i> æŠ€è¡“æŒ‡æ¨™</h3>
                            <div class="indicators-grid">
                                <div class="indicator-item">
                                    <span class="indicator-label">MA5</span>
                                    <span class="indicator-value" id="ma5-value">--</span>
                                </div>
                                <div class="indicator-item">
                                    <span class="indicator-label">MA20</span>
                                    <span class="indicator-value" id="ma20-value">--</span>
                                </div>
                                <div class="indicator-item">
                                    <span class="indicator-label">MA50</span>
                                    <span class="indicator-value" id="ma50-value">--</span>
                                </div>
                                <div class="indicator-item">
                                    <span class="indicator-label">RSI</span>
                                    <span class="indicator-value" id="rsi-value">--</span>
                                </div>
                            </div>
                        </div>

                        <!-- å¢å¼·çš„äº¤æ˜“è¨Šè™Ÿç›£æ¸¬ -->
                        <div class="enhanced-signal-display" id="enhanced-signal-display" style="display: block;">
                            <h3 style="margin-bottom: 1.2em;"><i class="fas fa-signal"></i> äº¤æ˜“è¨Šè™Ÿç›£æ¸¬</h3>
                            <div class="signal-grid" style="gap: 1.2em;">
                                <div class="signal-item" id="ma-cross-signal" style="margin-bottom: 1em;">
                                    <div class="signal-header" style="margin-bottom: 0.4em;">
                                        <span class="signal-label" style="margin-right: 0.6em;">MA5/MA20 äº¤å‰</span>
                                        <span class="signal-status" id="ma-cross-status">--</span>
                                    </div>
                                    <div class="signal-description" id="ma-cross-description"
                                        style="color: var(--text-muted);">
                                        æª¢æ¸¬æ˜¯å¦å‡ºç¾é»ƒé‡‘äº¤å‰/æ­»äº¡äº¤å‰
                                    </div>
                                </div>

                                <div class="signal-item" id="rsi-signal" style="margin-bottom: 1em;">
                                    <div class="signal-header" style="margin-bottom: 0.4em;">
                                        <span class="signal-label" style="margin-right: 0.6em;">RSI å€é–“</span>
                                        <span class="signal-status" id="rsi-status">--</span>
                                    </div>
                                    <div class="signal-description" id="rsi-description"
                                        style="color: var(--text-muted);">
                                        RSI &gt; 70 éç†±ï¼ŒRSI &lt; 30 éå†·
                                    </div>
                                </div>


                            </div>
                        </div>

                        <div class="chart-section">
                            <div class="chart-header">
                                <h3><i class="fas fa-chart-area"></i> åƒ¹æ ¼èµ°å‹¢åœ–</h3>
                                <div class="chart-controls">
                                    <div class="line-controls">
                                        <label class="line-toggle">
                                            <input type="checkbox" id="show-ma5" checked>
                                            <span class="toggle-label">MA5</span>
                                        </label>
                                        <label class="line-toggle">
                                            <input type="checkbox" id="show-ma20" checked>
                                            <span class="toggle-label">MA20</span>
                                        </label>
                                        <label class="line-toggle">
                                            <input type="checkbox" id="show-ma125" checked>
                                            <span class="toggle-label">MA125</span>
                                        </label>
                                        <label class="line-toggle">
                                            <input type="checkbox" id="show-quarterly" checked>
                                            <span class="toggle-label">è½‰æŠ˜é»</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-container" id="chart-container">
                                <canvas id="goldChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- è©³ç´°æ•¸æ“šæ—¥èªŒ - Accordionæ”¶åˆçµæ§‹ -->
                <div class="card data-details-card" id="data-logs-section" style="margin-top: 2rem;">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-database"></i>
                        </div>
                        <h2>è©³ç´°æ•¸æ“šæ—¥èªŒ</h2>
                        <button onclick="toggleDataDetails()" class="action-btn secondary" id="details-toggle">
                            <i class="fas fa-eye"></i>
                            <span>é¡¯ç¤ºè©³æƒ…</span>
                        </button>
                    </div>
                    <div class="card-content" id="data-details" style="display: block;">
                        <div class="accordion-container">
                            <div class="accordion-item" id="system-info-accordion">
                                <div class="accordion-header" onclick="toggleAccordion('system-info-accordion')">
                                    <span><i class="fas fa-info-circle"></i> ç³»çµ±è³‡è¨Š</span>
                                    <i class="fas fa-plus accordion-icon"></i>
                                </div>
                                <div class="accordion-content" id="system-info-content">
                                    <div class="accordion-placeholder">
                                        <span>é»æ“Šä¸Šæ–¹æŒ‰éˆ•æˆ–ä½¿ç”¨"é¡¯ç¤ºè©³æƒ…"æŸ¥çœ‹ç³»çµ±è³‡è¨Š</span>
                                    </div>
                                </div>
                            </div>

                            <div class="accordion-item" id="gold-price-accordion">
                                <div class="accordion-header" onclick="toggleAccordion('gold-price-accordion')">
                                    <span><i class="fas fa-coins"></i> é»ƒé‡‘åƒ¹æ ¼è©³æƒ…</span>
                                    <i class="fas fa-plus accordion-icon"></i>
                                </div>
                                <div class="accordion-content" id="gold-price-content">
                                    <div class="accordion-placeholder">
                                        <span>é»æ“Šä¸Šæ–¹æŒ‰éˆ•æˆ–ä½¿ç”¨"é¡¯ç¤ºè©³æƒ…"æŸ¥çœ‹é»ƒé‡‘åƒ¹æ ¼è©³æƒ…</span>
                                    </div>
                                </div>
                            </div>

                            <div class="accordion-item" id="technical-indicators-accordion">
                                <div class="accordion-header"
                                    onclick="toggleAccordion('technical-indicators-accordion')">
                                    <span><i class="fas fa-chart-line"></i> æŠ€è¡“æŒ‡æ¨™è©³æƒ…</span>
                                    <i class="fas fa-plus accordion-icon"></i>
                                </div>
                                <div class="accordion-content" id="technical-indicators-content">
                                    <div class="accordion-placeholder">
                                        <span>é»æ“Šä¸Šæ–¹æŒ‰éˆ•æˆ–ä½¿ç”¨"é¡¯ç¤ºè©³æƒ…"æŸ¥çœ‹æŠ€è¡“æŒ‡æ¨™è©³æƒ…</span>
                                    </div>
                                </div>
                            </div>

                            <div class="accordion-item" id="market-sentiment-accordion">
                                <div class="accordion-header" onclick="toggleAccordion('market-sentiment-accordion')">
                                    <span><i class="fas fa-brain"></i> å¸‚å ´æƒ…æ„Ÿåˆ†æè©³æƒ…</span>
                                    <i class="fas fa-plus accordion-icon"></i>
                                </div>
                                <div class="accordion-content" id="market-sentiment-content">
                                    <div class="accordion-placeholder">
                                        <span>é»æ“Šä¸Šæ–¹æŒ‰éˆ•æˆ–ä½¿ç”¨"é¡¯ç¤ºè©³æƒ…"æŸ¥çœ‹å¸‚å ´æƒ…æ„Ÿåˆ†æè©³æƒ…</span>
                                    </div>
                                </div>
                            </div>

                            <div class="accordion-item" id="chart-data-accordion">
                                <div class="accordion-header" onclick="toggleAccordion('chart-data-accordion')">
                                    <span><i class="fas fa-database"></i> åœ–è¡¨æ•¸æ“šæ¨£æœ¬</span>
                                    <i class="fas fa-plus accordion-icon"></i>
                                </div>
                                <div class="accordion-content" id="chart-data-content">
                                    <div class="accordion-placeholder">
                                        <span>é»æ“Šä¸Šæ–¹æŒ‰éˆ•æˆ–ä½¿ç”¨"é¡¯ç¤ºè©³æƒ…"æŸ¥çœ‹åœ–è¡¨æ•¸æ“šæ¨£æœ¬</span>
                                    </div>
                                </div>
                            </div>

                            <div class="accordion-item" id="yearly-stats-accordion">
                                <div class="accordion-header" onclick="toggleAccordion('yearly-stats-accordion')">
                                    <span><i class="fas fa-chart-bar"></i> å®Œæ•´å¹´åº¦æ•¸æ“šçµ±è¨ˆ</span>
                                    <i class="fas fa-plus accordion-icon"></i>
                                </div>
                                <div class="accordion-content" id="yearly-stats-content">
                                    <div class="accordion-placeholder">
                                        <span>é»æ“Šä¸Šæ–¹æŒ‰éˆ•æˆ–ä½¿ç”¨"é¡¯ç¤ºè©³æƒ…"æŸ¥çœ‹å®Œæ•´å¹´åº¦æ•¸æ“šçµ±è¨ˆ</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="page-footer">
            <div class="footer-content">
                <div class="footer-info">
                    <h3>å¸‚å ´åˆ†æå ±å‘Šç³»çµ±</h3>
                    <p>AI é©…å‹•çš„æ™ºèƒ½å¸‚å ´åˆ†æèˆ‡å ±å‘Šç”Ÿæˆå¹³å°</p>
                </div>
                <div class="footer-stats">
                    <div class="stat-item">
                        <span class="stat-label">ç³»çµ±ç‰ˆæœ¬</span>
                        <span class="stat-value">v2.1.4</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">æ•¸æ“šä¾†æº</span>
                        <span class="stat-value">Yahoo Finance</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ä¸‹æ¬¡æ›´æ–°</span>
                        <span class="stat-value" id="next-update">--</span>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // ===== å…¨åŸŸè®Šæ•¸ =====
        let goldChart = null;
        let goldPriceData = null;
        let marketData = null;
        let currentPeriod = '1y'; // å›ºå®šç‚ºä¸€å¹´
        let autoRefreshInterval = null;
        let detailsVisible = false;
        let showMA5 = true;
        let showMA20 = true;
        let showMA125 = true;
        let showQuarterly = true;

        // ===== åˆå§‹åŒ– =====
        document.addEventListener('DOMContentLoaded', function () {
            console.log('ğŸš€ å¸‚å ´åˆ†æç³»çµ±è¼‰å…¥ä¸­...');

            // æª¢æŸ¥Chart.jsæ˜¯å¦è¼‰å…¥
            if (typeof Chart === 'undefined') {
                console.error('âŒ Chart.js æœªè¼‰å…¥ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£æ¥');
            } else {
                console.log('âœ… Chart.js å·²è¼‰å…¥');
                console.log('Chart.js ç‰ˆæœ¬:', Chart.version);
            }

            // é–‹å§‹è¼‰å…¥æ•¸æ“š
            initializeSystem();

            // è¨­å®šäº‹ä»¶ç›£è½
            setupEventListeners();

            // å•Ÿå‹•æ™‚é–“æ›´æ–°
            updateSystemTime();
            setInterval(updateSystemTime, 1000);

            // è¨­å®šè‡ªå‹•åˆ·æ–°ï¼ˆæ¯5åˆ†é˜ï¼‰
            autoRefreshInterval = setInterval(refreshAllData, 60000);

            // ç›£è½è¦–çª—å¤§å°æ”¹è®Š
            window.addEventListener('resize', () => {
                if (goldChart && goldPriceData) {
                    setTimeout(() => {
                        createGoldChart(goldPriceData);
                    }, 100);
                }
            });

            console.log('âœ… ç³»çµ±åˆå§‹åŒ–å®Œæˆ');
        });

        // ===== ç³»çµ±åˆå§‹åŒ– =====
        async function initializeSystem() {
            console.log('ğŸ“Š é–‹å§‹è¼‰å…¥æ‰€æœ‰æ•¸æ“š...');

            // ä¸¦è¡Œè¼‰å…¥æ•¸æ“š
            await Promise.all([
                loadMarketData(),
                loadGoldPrice(currentPeriod, true)
            ]);

            console.log('âœ… æ‰€æœ‰æ•¸æ“šè¼‰å…¥å®Œæˆ');
        }

        // ===== äº‹ä»¶ç›£è½è¨­å®š =====
        function setupEventListeners() {
            // ç·šæ¢é¡¯ç¤ºæ§åˆ¶
            const lineToggles = document.querySelectorAll('.line-toggle input');
            lineToggles.forEach(toggle => {
                toggle.addEventListener('change', function () {
                    const lineType = this.id.replace('show-', '');
                    console.log(`ğŸ“ˆ åˆ‡æ›ç·šæ¢é¡¯ç¤º: ${lineType} = ${this.checked}`);

                    if (lineType === 'ma5') showMA5 = this.checked;
                    if (lineType === 'ma20') showMA20 = this.checked;
                    if (lineType === 'ma125') showMA125 = this.checked;
                    if (lineType === 'quarterly') showQuarterly = this.checked;

                    if (goldPriceData) {
                        createGoldChart(goldPriceData);
                    }
                });
            });

            console.log('ğŸ¯ äº‹ä»¶ç›£è½å™¨è¨­å®šå®Œæˆ');
        }

        // ===== æ™‚é–“æ›´æ–° =====
        function updateSystemTime() {
            const now = new Date();
            const timeElement = document.getElementById('current-time');
            if (timeElement) {
                timeElement.textContent = now.toLocaleTimeString('zh-TW');
            }
        }

        // ===== è¼‰å…¥å¸‚å ´æ•¸æ“š =====
        async function loadMarketData() {
            try {
                console.log('ğŸ“ˆ é–‹å§‹è¼‰å…¥å¸‚å ´æƒ…æ„Ÿåˆ†ææ•¸æ“š...');
                updateMarketStatus('loading', 'è¼‰å…¥ä¸­...');

                const response = await fetch('/api/current-data');
                const result = await response.json();

                console.log('ğŸ“¥ å¸‚å ´æ•¸æ“šAPIå›æ‡‰:', result);

                if (response.ok && result.status === 'success') {
                    if (result.data && typeof result.data === 'object' && Object.keys(result.data).length > 0) {
                        marketData = result.data;
                        console.log('âœ… æˆåŠŸæ¥æ”¶å¸‚å ´æ•¸æ“š:', marketData);
                        displayMarketData(marketData);
                        updateMarketStatus('connected', 'å·²é€£æ¥');


                    } else {
                        console.log('âš ï¸ å¸‚å ´æ•¸æ“šç‚ºç©º');
                        displayNoMarketData();
                        updateMarketStatus('waiting', 'ç­‰å¾…æ•¸æ“š...');
                    }
                } else {
                    throw new Error(result.message || `HTTP éŒ¯èª¤: ${response.status}`);
                }
            } catch (error) {
                console.error('âŒ è¼‰å…¥å¸‚å ´æ•¸æ“šå¤±æ•—:', error);
                displayMarketError('ç„¡æ³•è¼‰å…¥å¸‚å ´æ•¸æ“š: ' + error.message);
                updateMarketStatus('error', 'é€£æ¥éŒ¯èª¤');
            }
        }

        // ===== è¼‰å…¥é»ƒé‡‘åƒ¹æ ¼æ•¸æ“š =====
        async function loadGoldPrice(period = currentPeriod, showLoading = true) {
            try {
                if (showLoading) {
                    updatePriceStatus('loading', 'è¼‰å…¥ä¸­...');
                    showPriceLoading();
                }

                console.log(`ğŸ” æ­£åœ¨ç²å–é»ƒé‡‘æœŸè²¨æ•¸æ“š - æœŸé–“: ${period}`);
                const response = await fetch(`/api/gold-price?period=${period}&interval=1d`);
                const result = await response.json();

                console.log('ğŸ’° é»ƒé‡‘åƒ¹æ ¼APIå›æ‡‰:', result);

                if (response.ok && result.status === 'success' && result.data) {
                    goldPriceData = result.data;
                    console.log('âœ… æˆåŠŸç²å–é»ƒé‡‘åƒ¹æ ¼æ•¸æ“š:');
                    console.log(`   åƒ¹æ ¼: $${result.data.current_price}`);
                    console.log(`   è®ŠåŒ–: ${result.data.change} (${result.data.change_percent}%)`);
                    console.log(`   æ•¸æ“šé»æ•¸é‡: ${result.data.chart_data?.length || 0}`);

                    displayGoldPrice(result.data);
                    updateTechnicalIndicators(result.data.technical_indicators || {});
                    updateEnhancedSignalDisplay(result.data);

                    // æª¢æŸ¥åœ–è¡¨æ•¸æ“š
                    console.log('ğŸ“Š æº–å‚™å‰µå»ºåœ–è¡¨ï¼Œæ•¸æ“šæª¢æŸ¥:');
                    console.log('chart_data å­˜åœ¨:', !!result.data.chart_data);
                    console.log('chart_data é¡å‹:', typeof result.data.chart_data);
                    console.log('chart_data é•·åº¦:', result.data.chart_data?.length);
                    if (result.data.chart_data && result.data.chart_data.length > 0) {
                        console.log('ç¬¬ä¸€å€‹æ•¸æ“šé»:', result.data.chart_data[0]);
                    }

                    // æª¢æŸ¥MAç·šæ•¸æ“š
                    console.log('MA5 æ•¸æ“šå­˜åœ¨:', !!result.data.ma_lines?.ma_5);
                    console.log('MA20 æ•¸æ“šå­˜åœ¨:', !!result.data.ma_lines?.ma_20);
                    console.log('æœˆå¹³å‡ç·šæ•¸æ“šå­˜åœ¨:', !!result.data.monthly_average_line);
                    console.log('å¹´å¹³å‡åƒ¹æ ¼ç·šæ•¸æ“šå­˜åœ¨:', !!result.data.yearly_average_line);
                    if (result.data.ma_lines?.ma_5) {
                        console.log('MA5 æ•¸æ“šé»æ•¸:', result.data.ma_lines.ma_5.length);
                    }
                    if (result.data.ma_lines?.ma_20) {
                        console.log('MA20 æ•¸æ“šé»æ•¸:', result.data.ma_lines.ma_20.length);
                    }
                    if (result.data.monthly_average_line) {
                        console.log('æœˆå¹³å‡ç·šæ•¸æ“šé»æ•¸:', result.data.monthly_average_line.length);
                    }
                    if (result.data.yearly_average_line) {
                        console.log('å¹´å¹³å‡åƒ¹æ ¼ç·šæ•¸æ“šé»æ•¸:', result.data.yearly_average_line.length);
                    }

                    // å»¶é²å‰µå»ºåœ–è¡¨ï¼Œç¢ºä¿DOMå®Œå…¨è¼‰å…¥
                    setTimeout(() => {
                        createGoldChart(result.data);
                    }, 500);

                    updatePriceStatus('connected', 'å³æ™‚æ›´æ–°');

                    if (result.next_update) {
                        document.getElementById('next-update').textContent =
                            new Date(result.next_update).toLocaleTimeString('zh-TW');
                    }

                    if (result.data.last_updated_formatted) {
                        updateGoldLastUpdated(`æœ€å¾Œæ›´æ–°: ${result.data.last_updated_formatted}`);
                    } else if (result.data.last_updated) {
                        const lastUpdated = new Date(result.data.last_updated);
                        updateGoldLastUpdated(`æœ€å¾Œæ›´æ–°: ${lastUpdated.toLocaleString('zh-TW')}`);
                    }

                    // æ›´æ–°è©³ç´°æ—¥èªŒ
                    updateDetailedLogs(result);

                } else {
                    throw new Error(result.message || `HTTP éŒ¯èª¤: ${response.status}`);
                }
            } catch (error) {
                console.error('âŒ è¼‰å…¥é»ƒé‡‘åƒ¹æ ¼å¤±æ•—:', error);
                displayPriceError('ç„¡æ³•è¼‰å…¥é»ƒé‡‘åƒ¹æ ¼: ' + error.message);
                updatePriceStatus('error', 'é€£æ¥éŒ¯èª¤');
            }
        }

        // ===== é¡¯ç¤ºå¸‚å ´æ•¸æ“š =====
        function displayMarketData(data) {
            console.log('ğŸ¨ é¡¯ç¤ºå¸‚å ´æ•¸æ“š:', data);

            // ç²å– score
            let score = 0;

            // å¾ raw_data ä¸­ç²å– score
            if (data.raw_data && data.raw_data.score !== undefined) {
                score = data.raw_data.score;
            } else if (data.average_sentiment_score !== undefined) {
                score = data.average_sentiment_score;
            }

            // å°‡ -1 åˆ° 1 çš„ç¯„åœè½‰æ›ç‚º 0 åˆ° 100 çš„ç¯„åœ
            // 0 = æ¥µåº¦ææ…Œ, 100 = æ¥µåº¦è²ªå©ª
            if (score >= -1 && score <= 1) {
                score = Math.round(((score + 1) / 2) * 100);
            }

            // ç²å–æ‘˜è¦å…§å®¹
            const summaryContent = getSummaryContent(data);

            const sentimentClass = getSentimentClass(score);
            const sentimentText = getSentimentText(score);
            const sentimentEmoji = getSentimentEmoji(score);

            // è™•ç†emailReportå…§å®¹ï¼ˆç”¨æ–¼éƒµä»¶ç™¼é€ï¼‰
            let emailReportContent = '';
            if (data.email_report) {
                emailReportContent = data.email_report;
                console.log('ğŸ“§ æ‰¾åˆ°emailReportå…§å®¹ï¼Œé•·åº¦:', emailReportContent.length);
            } else if (data.raw_data && data.raw_data.emailReport) {
                emailReportContent = data.raw_data.emailReport;
                console.log('ğŸ“§ å¾raw_dataæ‰¾åˆ°emailReportå…§å®¹ï¼Œé•·åº¦:', emailReportContent.length);
            }

            const display = document.getElementById('market-data-display');
            display.innerHTML = `
                <div class="market-data">
                    <div class="data-row sentiment-highlight">
                        <div class="data-label">
                            <i class="fas fa-heart-pulse"></i>
                            å¸‚å ´æƒ…ç·’æŒ‡æ•¸
                        </div>
                        <div class="data-value">
                            <span class="sentiment-score sentiment-${sentimentClass}">
                                ${sentimentEmoji} ${sentimentText} (${score}/100)
                            </span>
                        </div>
                    </div>

                    <div class="data-row">
                        <div class="data-label">
                            <i class="fas fa-calendar-day"></i>
                            å¸‚å ´æ—¥æœŸ
                        </div>
                        <div class="data-value">${data.market_date || 'æœªçŸ¥'}</div>
                    </div>

                    <div class="data-row full-width">
                        <div class="data-label">
                            <i class="fas fa-newspaper"></i>
                            å¸‚å ´æƒ…ç·’æ‘˜è¦
                        </div>
                        <div class="market-content" id="market-content">
                            ${summaryContent || 'ç„¡æ‘˜è¦å…§å®¹'}
                        </div>
                        ${(summaryContent && summaryContent.length > 200)
                    ? '<button class="expand-btn" onclick="toggleMarketContent()">å±•é–‹å…¨æ–‡</button>'
                    : ''}
                    </div>

                    <div class="data-row">
                        <div class="data-label">
                            <i class="fas fa-clock"></i>
                            æ¥æ”¶æ™‚é–“
                        </div>
                        <div class="data-value">${data.received_time || 'æœªçŸ¥'}</div>
                    </div>
                </div>
            `;
        }

        // ===== é¡¯ç¤ºé»ƒé‡‘åƒ¹æ ¼ =====
        function displayGoldPrice(data) {
            console.log('ğŸ’° é¡¯ç¤ºé»ƒé‡‘åƒ¹æ ¼æ•¸æ“š:', data);

            const priceChangeClass = data.change >= 0 ? 'positive' : 'negative';
            const priceChangeIcon = data.change >= 0 ? 'fa-arrow-up' : 'fa-arrow-down';

            const display = document.getElementById('price-display');
            display.innerHTML = `
                <div class="gold-price-info">
                    <div class="price-main">
                        <div class="current-price">
                            <span class="price-value">$${data.current_price?.toFixed(2) || 'N/A'}</span>
                            <span class="price-unit">${data.unit || 'USD/oz'} (USD)</span>
                        </div>
                        <div class="price-change ${priceChangeClass}">
                            <i class="fas ${priceChangeIcon}"></i>
                            <span>${data.change >= 0 ? '+' : ''}${data.change?.toFixed(2) || 'N/A'}</span>
                            <span>(${data.change_percent >= 0 ? '+' : ''}${data.change_percent?.toFixed(2) || 'N/A'}%)</span>
                        </div>
                    </div>

                    <div class="price-statistics">
                        <div class="stat-grid">
                            <div class="stat-item">
                                <span class="stat-label">ç•¶æ—¥é«˜</span>
                                <span class="stat-value">$${data.today_high?.toFixed(2) || 'N/A'}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">ç•¶æ—¥ä½</span>
                                <span class="stat-value">$${data.today_low?.toFixed(2) || 'N/A'}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">å¹´å¹³å‡åƒ¹æ ¼</span>
                                <span class="stat-value">$${data.avg_price?.toFixed(2) || 'N/A'}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">å¹´æ¨™æº–å·®</span>
                                <span class="stat-value">${data.volatility?.toFixed(2) || 'N/A'}</span>
                            </div>

                            <div class="stat-item">
                                <span class="stat-label">å¸‚å ´ç‹€æ…‹</span>
                                <span class="stat-value market-${data.market_status}">${getMarketStatusText(data.market_status)}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ===== å‰µå»ºé»ƒé‡‘åƒ¹æ ¼åœ–è¡¨ =====
        function createGoldChart(data) {
            console.log('ğŸ¨ é–‹å§‹å‰µå»ºé»ƒé‡‘åƒ¹æ ¼åœ–è¡¨...');
            console.log('æ¥æ”¶åˆ°çš„æ•¸æ“š:', data);

            const canvas = document.getElementById('goldChart');
            const container = document.getElementById('chart-container');

            if (!canvas) {
                console.error('âŒ æ‰¾ä¸åˆ° Canvas å…ƒç´ : goldChart');
                return;
            }

            if (!container) {
                console.error('âŒ æ‰¾ä¸åˆ°åœ–è¡¨å®¹å™¨: chart-container');
                return;
            }

            // æª¢æŸ¥å®¹å™¨æ˜¯å¦å¯è¦‹
            const containerStyle = window.getComputedStyle(container);
            console.log('å®¹å™¨é¡¯ç¤ºç‹€æ…‹:', containerStyle.display);
            console.log('å®¹å™¨å¯è¦‹æ€§:', containerStyle.visibility);

            // ç¢ºä¿å®¹å™¨å¯è¦‹
            if (containerStyle.display === 'none') {
                container.style.display = 'block';
            }

            // é‡è¦ï¼šæ­£ç¢ºéŠ·æ¯€ç¾æœ‰åœ–è¡¨
            if (goldChart) {
                console.log('ğŸ—‘ï¸ éŠ·æ¯€ç¾æœ‰åœ–è¡¨');
                goldChart.destroy();
                goldChart = null;
            }

            // é‡æ–°è¨­ç½® Canvas å°ºå¯¸
            canvas.width = container.offsetWidth || 800;
            canvas.height = container.offsetHeight || 400;
            canvas.style.width = '100%';
            canvas.style.height = '100%';
            console.log('Canvas å°ºå¯¸:', canvas.width, 'x', canvas.height);
            console.log('å®¹å™¨å°ºå¯¸:', container.offsetWidth, 'x', container.offsetHeight);

            if (!data.chart_data || !Array.isArray(data.chart_data) || data.chart_data.length === 0) {
                console.warn('âš ï¸ åœ–è¡¨æ•¸æ“šç‚ºç©ºæˆ–ç„¡æ•ˆï¼Œä¸æ¸²æŸ“åœ–è¡¨');
                console.log('æ•¸æ“šè©³æƒ…:', data.chart_data);
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                return;
            }

            console.log(`ğŸ“Š å‰µå»ºåœ–è¡¨ï¼Œæ•¸æ“šé»: ${data.chart_data.length}`);
            console.log('åŸå§‹æ•¸æ“šæ¨£æœ¬:', data.chart_data.slice(0, 3));

            const chartData = data.chart_data;

            // ç°¡åŒ–æ•¸æ“šè™•ç†ï¼Œä½¿ç”¨å­—ç¬¦ä¸²æ—¥æœŸ
            const labels = chartData.map(d => d.time);
            const prices = chartData.map(d => parseFloat(d.price) || 0);

            console.log('è™•ç†å¾Œçš„æ¨™ç±¤:', labels.slice(0, 5));
            console.log('è™•ç†å¾Œçš„åƒ¹æ ¼:', prices.slice(0, 5));
            console.log('æ¨™ç±¤ç¸½æ•¸:', labels.length);
            console.log('åƒ¹æ ¼ç¸½æ•¸:', prices.length);
            console.log('æœ‰æ•ˆåƒ¹æ ¼æ•¸é‡:', prices.filter(p => p > 0).length);

            // æº–å‚™æ•¸æ“šé›† - ä½¿ç”¨ç°¡å–®çš„æ•¸çµ„æ ¼å¼
            const validPrices = prices.filter(p => p > 0);
            const validLabels = labels.slice(0, validPrices.length);

            console.log('æœ‰æ•ˆåƒ¹æ ¼æ•¸é‡:', validPrices.length);
            console.log('æœ‰æ•ˆæ¨™ç±¤æ•¸é‡:', validLabels.length);
            console.log('æœ‰æ•ˆæ¨™ç±¤æ¨£æœ¬:', validLabels.slice(0, 5));
            console.log('ä¸»æ•¸æ“šæ™‚é–“æ ¼å¼æ¨£æœ¬:', validLabels.slice(0, 3).map(label => {
                const date = new Date(label);
                return {
                    original: label,
                    date: date.toISOString().split('T')[0]
                };
            }));

            const datasets = [{
                label: 'é»ƒé‡‘åƒ¹æ ¼ (USD/oz)',
                data: validPrices,
                borderColor: '#FFD700',
                backgroundColor: 'rgba(255, 215, 0, 0.1)',
                borderWidth: 2,
                fill: true,
                tension: 0.4,
                pointRadius: 0,
                pointHoverRadius: 6,
                spanGaps: true
            }];

            console.log('ä¸»æ•¸æ“šæ ¼å¼æª¢æŸ¥:', {
                validPricesLength: validPrices.length,
                validPricesSample: validPrices.slice(0, 3),
                validLabelsLength: validLabels.length,
                validLabelsSample: validLabels.slice(0, 3)
            });

            // æ·»åŠ MA5ç·š
            if (showMA5 && data.ma_lines && data.ma_lines.ma_5) {
                console.log('ğŸ” è™•ç†MA5æ•¸æ“š...');
                // å‰µå»ºMA5æ•¸æ“šæ˜ å°„
                const ma5Map = {};
                data.ma_lines.ma_5.forEach(d => {
                    ma5Map[d.time] = parseFloat(d.price) || 0;
                });

                console.log('MA5æ˜ å°„æ¨£æœ¬:', Object.keys(ma5Map).slice(0, 5));

                // å°é½Šåˆ°ä¸»æ•¸æ“šçš„æ™‚é–“è»¸
                const ma5Prices = validLabels.map(label => ma5Map[label] || null);
                const validMa5Prices = ma5Prices.filter(p => p !== null && p > 0);

                // ç¢ºä¿æ•¸æ“šé•·åº¦èˆ‡ä¸»æ•¸æ“šä¸€è‡´
                const alignedMa5Prices = validLabels.map(label => ma5Map[label] || null);

                console.log('MA5å°é½Šæ•¸æ“šé»æ•¸:', alignedMa5Prices.filter(p => p !== null).length);

                if (alignedMa5Prices.filter(p => p !== null).length > 0) {
                    datasets.push({
                        label: 'MA5',
                        data: alignedMa5Prices,
                        borderColor: '#FF6B6B',
                        backgroundColor: 'transparent',
                        borderWidth: 1.5,
                        fill: false,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 4,
                        spanGaps: true
                    });
                }
            }

            // æ·»åŠ MA20ç·š
            if (showMA20 && data.ma_lines && data.ma_lines.ma_20) {
                console.log('ğŸ” è™•ç†MA20æ•¸æ“š...');
                // å‰µå»ºMA20æ•¸æ“šæ˜ å°„
                const ma20Map = {};
                data.ma_lines.ma_20.forEach(d => {
                    ma20Map[d.time] = parseFloat(d.price) || 0;
                });

                console.log('MA20æ˜ å°„æ¨£æœ¬:', Object.keys(ma20Map).slice(0, 5));

                // å°é½Šåˆ°ä¸»æ•¸æ“šçš„æ™‚é–“è»¸
                const ma20Prices = validLabels.map(label => ma20Map[label] || null);
                const validMa20Prices = ma20Prices.filter(p => p !== null && p > 0);

                // ç¢ºä¿æ•¸æ“šé•·åº¦èˆ‡ä¸»æ•¸æ“šä¸€è‡´
                const alignedMa20Prices = validLabels.map(label => ma20Map[label] || null);

                console.log('MA20å°é½Šæ•¸æ“šé»æ•¸:', alignedMa20Prices.filter(p => p !== null).length);

                if (alignedMa20Prices.filter(p => p !== null).length > 0) {
                    datasets.push({
                        label: 'MA20',
                        data: alignedMa20Prices,
                        borderColor: '#4ECDC4',
                        backgroundColor: 'transparent',
                        borderWidth: 1.5,
                        fill: false,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 4,
                        spanGaps: true
                    });
                }
            }

            // æ·»åŠ MA125ç·š
            if (showMA125 && data.ma_125_line && data.ma_125_line.length > 0) {
                console.log('ğŸ” è™•ç†MA125æ•¸æ“š...');
                console.log('MA125åŸå§‹æ•¸æ“š:', data.ma_125_line);

                // å‰µå»ºMA125æ•¸æ“šæ˜ å°„
                const ma125Map = {};
                data.ma_125_line.forEach(d => {
                    ma125Map[d.time] = parseFloat(d.price) || 0;
                });

                console.log('MA125æ˜ å°„æ¨£æœ¬:', Object.keys(ma125Map).slice(0, 5));
                console.log('MA125æ˜ å°„å€¼æ¨£æœ¬:', Object.values(ma125Map).slice(0, 5));

                // å°é½Šåˆ°ä¸»æ•¸æ“šçš„æ™‚é–“è»¸
                const alignedMA125Prices = validLabels.map(label => {
                    return ma125Map[label] || null;
                });

                console.log('MA125å°é½Šæ•¸æ“šé»æ•¸:', alignedMA125Prices.filter(p => p !== null).length);
                console.log('MA125å°é½Šæ•¸æ“šæ¨£æœ¬:', alignedMA125Prices.slice(0, 10));

                if (alignedMA125Prices.filter(p => p !== null).length > 0) {
                    datasets.push({
                        label: 'MA125',
                        data: alignedMA125Prices,
                        borderColor: '#8B5CF6',
                        backgroundColor: 'transparent',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 4,
                        borderDash: [6, 3],
                        spanGaps: true
                    });
                } else {
                    console.log('âš ï¸ MA125æ²’æœ‰æœ‰æ•ˆæ•¸æ“šé»');
                }
            } else {
                console.log('âš ï¸ MA125æ•¸æ“šä¸å­˜åœ¨æˆ–ç‚ºç©º');
                console.log('showMA125:', showMA125);
                console.log('data.ma_125_line å­˜åœ¨:', !!data.ma_125_line);
                console.log('data.ma_125_line é•·åº¦:', data.ma_125_line?.length);
            }

            // æ·»åŠ è½‰æŠ˜é»ç·š
            if (showQuarterly && data.pivot_points && data.pivot_points.length > 0) {
                console.log('ğŸ” è™•ç†è½‰æŠ˜é»æ•¸æ“š...');
                console.log('è½‰æŠ˜é»åŸå§‹æ•¸æ“š:', data.pivot_points);

                // ä¿®æ­£ï¼šå‰µå»ºç¨ç«‹çš„è½‰æŠ˜é»æ•¸æ“šé›†ï¼Œç¢ºä¿èƒ½é€£æˆä¸€æ¢æŠ˜ç·šåœ–
                const pivotLabels = data.pivot_points.map(d => d.time);
                const pivotPrices = data.pivot_points.map(d => parseFloat(d.price) || 0);

                console.log('è½‰æŠ˜é»æ¨™ç±¤:', pivotLabels);
                console.log('è½‰æŠ˜é»åƒ¹æ ¼:', pivotPrices);

                if (pivotPrices.length > 0) {
                    // ä¿®æ­£ï¼šå‰µå»ºå°é½Šåˆ°ä¸»æ•¸æ“šæ™‚é–“è»¸çš„è½‰æŠ˜é»æ•¸æ“šé›†
                    const pivotMap = {};
                    data.pivot_points.forEach(d => {
                        pivotMap[d.time] = parseFloat(d.price) || 0;
                    });

                    // å°é½Šåˆ°ä¸»æ•¸æ“šçš„æ™‚é–“è»¸
                    const alignedPivotPrices = validLabels.map(label => {
                        return pivotMap[label] || null;
                    });

                    console.log('è½‰æŠ˜é»å°é½Šæ•¸æ“šé»æ•¸:', alignedPivotPrices.filter(p => p !== null).length);

                    if (alignedPivotPrices.filter(p => p !== null).length > 0) {
                        datasets.push({
                            label: 'è½‰æŠ˜é»',
                            data: alignedPivotPrices,
                            borderColor: '#FF8C00',
                            backgroundColor: 'transparent',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.1, // æ¸›å°‘æ›²ç·šå¼µåŠ›ï¼Œè®“ç·šæ›´ç›´
                            pointRadius: 2, // ç¸®å°é»çš„å¤§å°
                            pointHoverRadius: 4, // ç¸®å°æ‡¸åœæ™‚é»çš„å¤§å°
                            pointBackgroundColor: '#FF8C00',
                            pointBorderColor: '#FF8C00',
                            borderDash: [0], // å¯¦ç·š
                            spanGaps: true, // å…è¨±è·¨è¶Šç©ºå€¼ï¼Œè®“ç·šæ¢é€£çºŒ
                            pointHitRadius: 8, // å¢åŠ é»æ“Šå€åŸŸï¼Œæ–¹ä¾¿äº¤äº’
                            pointBorderWidth: 1, // é»é‚Šæ¡†å¯¬åº¦
                            pointStyle: 'circle' // ç¢ºä¿é»æ˜¯åœ“å½¢
                        });
                    } else {
                        console.log('âš ï¸ è½‰æŠ˜é»å°é½Šå¾Œæ²’æœ‰æœ‰æ•ˆæ•¸æ“šé»');
                    }
                } else {
                    console.log('âš ï¸ è½‰æŠ˜é»æ²’æœ‰æœ‰æ•ˆæ•¸æ“šé»');
                }
            } else {
                console.log('âš ï¸ è½‰æŠ˜é»æ•¸æ“šä¸å­˜åœ¨æˆ–ç‚ºç©º');
                console.log('showQuarterly:', showQuarterly);
                console.log('data.pivot_points å­˜åœ¨:', !!data.pivot_points);
                console.log('data.pivot_points é•·åº¦:', data.pivot_points?.length);
            }

            // æª¢æŸ¥äº¤å‰ä¿¡è™Ÿ
            let crossSignalText = '';
            if (data.cross_signal) {
                crossSignalText = data.cross_signal.message;
                console.log('ğŸ“Š äº¤å‰ä¿¡è™Ÿ:', data.cross_signal);
                console.log('ğŸ“Š ä¿¡è™Ÿç‹€æ…‹:', data.cross_signal.status);
                console.log('ğŸ“Š ä¿¡è™Ÿæ¶ˆæ¯:', crossSignalText);
            }

            const config = {
                type: 'line',
                data: {
                    labels: validLabels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {
                        padding: {
                            bottom: 20,   // æ•´å¼µåœ–åº•éƒ¨å¤šç•™ 20px
                            top: crossSignalText ? 40 : 20  // å¦‚æœæœ‰äº¤å‰ä¿¡è™Ÿï¼Œé ‚éƒ¨å¤šç•™ç©ºé–“
                        }
                    },
                    elements: {
                        point: {
                            radius: 0
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: `é»ƒé‡‘æœŸè²¨åƒ¹æ ¼èµ°å‹¢ (ä¸€å¹´)`,
                            color: '#f8fafc',
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: {
                            labels: { color: '#cbd5e1' }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.9)',
                            titleColor: '#f8fafc',
                            bodyColor: '#cbd5e1',
                            borderColor: '#334155',
                            borderWidth: 1,
                            callbacks: {
                                title: function (context) {
                                    const dataIndex = context[0].dataIndex;
                                    if (dataIndex < labels.length) {
                                        return labels[dataIndex];
                                    }
                                    return 'æœªçŸ¥æ—¥æœŸ';
                                },
                                label: function (context) {
                                    return `${context.dataset.label}: $${context.parsed.y.toFixed(2)}`;
                                }
                            }
                        },
                        annotation: crossSignalText ? {
                            annotations: {
                                crossSignal: {
                                    type: 'label',
                                    xValue: 0.95,
                                    yValue: 0.95,
                                    backgroundColor: data.cross_signal.status === 'golden_cross' ? 'rgba(16, 185, 129, 0.9)' :
                                        data.cross_signal.status === 'death_cross' ? 'rgba(239, 68, 68, 0.9)' :
                                            'rgba(100, 116, 139, 0.9)',
                                    content: [crossSignalText],
                                    color: '#ffffff',
                                    font: {
                                        size: 12,
                                        weight: 'bold'
                                    },
                                    padding: 8,
                                    borderRadius: 4,
                                    position: 'end'
                                }
                            }
                        } : {}
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#64748b',
                                rotation: 0,  // æ—‹è½‰è§’åº¦
                                minRotation: 0,  // æœ€å°æ—‹è½‰è§’åº¦
                                maxRotation: 0,  // æœ€å¤§æ—‹è½‰è§’åº¦
                                autoSkip: true,
                                font: {
                                    size: 12,
                                    weight: 'normal'
                                },
                                callback: function (value, index, ticks) {
                                    if (index < validLabels.length) {
                                        const date = new Date(validLabels[index]);
                                        if (!isNaN(date.getTime())) {
                                            const year = date.getFullYear();
                                            const month = date.getMonth() + 1;
                                            return `${year}å¹´${month}æœˆ`;
                                        }
                                    }
                                    return '';
                                }
                            },
                            grid: {
                                color: 'rgba(100, 116, 139, 0.1)'
                            },
                            afterFit: function (scale) {
                                scale.paddingTop = 10;
                                scale.paddingBottom = 10;
                            }
                        },
                        y: {
                            ticks: {
                                color: '#64748b',
                                callback: function (value) {
                                    return '$' + value.toFixed(0);
                                }
                            },
                            grid: { color: 'rgba(100, 116, 139, 0.1)' }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    layout: {
                        padding: {
                            top: 20,
                            bottom: 60
                        }
                    },
                    plugins: {
                        legend: {
                            labels: { color: '#cbd5e1' }
                        }
                    },
                    animation: {
                        duration: 1000
                    }
                }
            };

            try {
                const ctx = canvas.getContext('2d');
                console.log('ğŸ¨ é–‹å§‹æ¸²æŸ“åœ–è¡¨...');
                console.log('Canvas å°ºå¯¸:', canvas.width, 'x', canvas.height);
                console.log('æ•¸æ“šé›†æ•¸é‡:', datasets.length);
                console.log('æœ‰æ•ˆåƒ¹æ ¼æ•¸æ“šé»æ•¸:', validPrices.length);

                // ç¢ºä¿ Chart.js å·²è¼‰å…¥
                if (typeof Chart === 'undefined') {
                    console.error('âŒ Chart.js æœªè¼‰å…¥');
                    return;
                }

                // æª¢æŸ¥æ•¸æ“šæ˜¯å¦æœ‰æ•ˆ
                if (validPrices.length === 0) {
                    console.error('âŒ æœ‰æ•ˆåƒ¹æ ¼æ•¸æ“šç‚ºç©ºï¼Œç„¡æ³•å‰µå»ºåœ–è¡¨');
                    return;
                }

                console.log('é…ç½®å°è±¡:', config);
                goldChart = new Chart(ctx, config);
                console.log('âœ… åœ–è¡¨å‰µå»ºæˆåŠŸ');
                console.log('åœ–è¡¨å¯¦ä¾‹:', goldChart);

                // å¼·åˆ¶Xè»¸æ¨™ç±¤æ°´å¹³é¡¯ç¤º
                setTimeout(() => {
                    if (goldChart && goldChart.options && goldChart.options.scales && goldChart.options.scales.x) {
                        goldChart.options.scales.x.ticks.rotation = 0;
                        goldChart.options.scales.x.ticks.maxTicksLimit = 6;
                        goldChart.update('none');

                        // å†æ¬¡å¼·åˆ¶æ›´æ–°
                        setTimeout(() => {
                            goldChart.update('none');
                        }, 200);
                    }
                }, 100);

            } catch (error) {
                console.error('âŒ å‰µå»ºåœ–è¡¨æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                console.error('éŒ¯èª¤è©³æƒ…:', error.message);
                console.error('éŒ¯èª¤å †ç–Š:', error.stack);
            }
        }

        // ===== æ›´æ–°æŠ€è¡“æŒ‡æ¨™ =====
        function updateTechnicalIndicators(indicators) {
            console.log('ğŸ“Š æ›´æ–°æŠ€è¡“æŒ‡æ¨™:', indicators);

            if (indicators.ma_5) {
                document.getElementById('ma5-value').textContent = '$' + indicators.ma_5.toFixed(2);
            }
            if (indicators.ma_20) {
                document.getElementById('ma20-value').textContent = '$' + indicators.ma_20.toFixed(2);
            }
            if (indicators.ma_50) {
                document.getElementById('ma50-value').textContent = '$' + indicators.ma_50.toFixed(2);
            }
            if (indicators.rsi) {
                const rsiElement = document.getElementById('rsi-value');
                rsiElement.textContent = indicators.rsi.toFixed(1);

                // RSI é¡è‰²æŒ‡ç¤º
                rsiElement.className = 'indicator-value';
                if (indicators.rsi > 70) {
                    rsiElement.classList.add('rsi-overbought');
                } else if (indicators.rsi < 30) {
                    rsiElement.classList.add('rsi-oversold');
                } else {
                    rsiElement.classList.add('rsi-neutral');
                }
            }
        }

        // ===== æ›´æ–°å¢å¼·çš„äº¤æ˜“è¨Šè™Ÿç›£æ¸¬ =====
        function updateEnhancedSignalDisplay(goldData) {
            console.log('ğŸ“Š æ›´æ–°å¢å¼·çš„äº¤æ˜“è¨Šè™Ÿç›£æ¸¬:', goldData);

            // MA5/MA20 äº¤å‰ä¿¡è™Ÿ
            updateMACrossSignal(goldData);

            // RSI å€é–“ä¿¡è™Ÿ
            updateRSISignal(goldData);


        }

        function updateMACrossSignal(goldData) {
            const statusElement = document.getElementById('ma-cross-status');
            const descriptionElement = document.getElementById('ma-cross-description');

            if (goldData.cross_signal && goldData.cross_signal.status) {
                let statusText = '';
                let statusClass = '';
                let description = '';

                switch (goldData.cross_signal.status) {
                    case 'golden_cross':
                        statusText = 'âœ… é»ƒé‡‘äº¤å‰';
                        statusClass = 'signal-success';
                        description = 'MA5 ä¸Šç©¿ MA20ï¼Œçœ‹æ¼²ä¿¡è™Ÿ';
                        break;
                    case 'death_cross':
                        statusText = 'âš ï¸ æ­»äº¡äº¤å‰';
                        statusClass = 'signal-warning';
                        description = 'MA5 ä¸‹ç©¿ MA20ï¼Œçœ‹è·Œä¿¡è™Ÿ';
                        break;
                    default:
                        statusText = 'âœ… æ­£å¸¸';
                        statusClass = 'signal-normal';
                        description = 'MA5 èˆ‡ MA20 ç„¡äº¤å‰ä¿¡è™Ÿ';
                }

                statusElement.textContent = statusText;
                statusElement.className = `signal-status ${statusClass}`;
                descriptionElement.textContent = description;
            }
        }

        function updateRSISignal(goldData) {
            const statusElement = document.getElementById('rsi-status');
            const descriptionElement = document.getElementById('rsi-description');

            if (goldData.technical_indicators && goldData.technical_indicators.rsi) {
                const rsi = goldData.technical_indicators.rsi;
                let statusText = '';
                let statusClass = '';
                let description = '';

                if (rsi > 70) {
                    statusText = 'âš ï¸ éç†±';
                    statusClass = 'signal-warning';
                    description = `RSI: ${rsi.toFixed(1)} > 70ï¼Œå¸‚å ´å¯èƒ½éç†±ï¼Œæ³¨æ„å›èª¿é¢¨éšª`;
                } else if (rsi < 30) {
                    statusText = 'âš ï¸ éå†·';
                    statusClass = 'signal-warning';
                    description = `RSI: ${rsi.toFixed(1)} < 30ï¼Œå¸‚å ´å¯èƒ½éå†·ï¼Œæ³¨æ„åå½ˆæ©Ÿæœƒ`;
                } else {
                    statusText = 'âœ… æ­£å¸¸';
                    statusClass = 'signal-success';
                    description = `RSI: ${rsi.toFixed(1)}ï¼Œå¸‚å ´è™•æ–¼æ­£å¸¸å€é–“`;
                }

                statusElement.textContent = statusText;
                statusElement.className = `signal-status ${statusClass}`;
                descriptionElement.textContent = description;
            }
        }



        // ===== æ›´æ–°è©³ç´°æ—¥èªŒ =====
        // æ¯å€‹ section éƒ½æœ‰è‡ªå·±çš„ accordion å±•é–‹/æ”¶åˆ
        function updateDetailedLogs(goldData) {
            console.log('ğŸ“ æ›´æ–°è©³ç´°æ—¥èªŒ');

            // æ›´æ–°ç³»çµ±è³‡è¨Š
            updateSystemInfoContent(document.getElementById('system-info-content'));

            // æ›´æ–°é»ƒé‡‘åƒ¹æ ¼è©³æƒ…
            updateGoldPriceContent(document.getElementById('gold-price-content'));

            // æ›´æ–°æŠ€è¡“æŒ‡æ¨™è©³æƒ…
            updateTechnicalIndicatorsContent(document.getElementById('technical-indicators-content'));

            // æ›´æ–°å¸‚å ´æƒ…æ„Ÿåˆ†æè©³æƒ…
            updateMarketSentimentContent(document.getElementById('market-sentiment-content'));

            // æ›´æ–°åœ–è¡¨æ•¸æ“šæ¨£æœ¬
            updateChartDataContent(document.getElementById('chart-data-content'));

            // æ›´æ–°å®Œæ•´å¹´åº¦æ•¸æ“šçµ±è¨ˆ
            updateYearlyStatsContent(document.getElementById('yearly-stats-content'));
        }

        // ===== Accordion æ”¶åˆåŠŸèƒ½ =====
        function toggleAccordion(accordionId) {
            console.log(`ğŸ“‹ åˆ‡æ› accordion: ${accordionId}`);

            const accordion = document.getElementById(accordionId);
            if (!accordion) {
                console.error(`âŒ æ‰¾ä¸åˆ° accordion: ${accordionId}`);
                return;
            }

            const content = accordion.querySelector('.accordion-content');
            const icon = accordion.querySelector('.accordion-icon');

            if (!content || !icon) {
                console.error(`âŒ æ‰¾ä¸åˆ° accordion å…§å®¹æˆ–åœ–æ¨™: ${accordionId}`);
                return;
            }

            const isExpanded = content.style.display === 'block';

            if (isExpanded) {
                // æ”¶åˆ
                content.style.display = 'none';
                content.classList.remove('expanded');
                icon.classList.remove('fa-minus');
                icon.classList.add('fa-plus');
                console.log(`ğŸ“‹ æ”¶åˆ accordion: ${accordionId}`);
            } else {
                // å±•é–‹
                content.style.display = 'block';
                content.classList.add('expanded');
                icon.classList.remove('fa-plus');
                icon.classList.add('fa-minus');
                console.log(`ğŸ“‹ å±•é–‹ accordion: ${accordionId}`);

                // å¦‚æœå±•é–‹ä¸”æœ‰æ•¸æ“šï¼Œæ›´æ–°å°æ‡‰å…§å®¹
                if (goldPriceData) {
                    updateAccordionContent(accordionId);
                }
            }
        }

        function updateAccordionContent(accordionId) {
            console.log(`ğŸ“ æ›´æ–° accordion å…§å®¹: ${accordionId}`);

            const contentId = accordionId.replace('-accordion', '-content');
            const contentElement = document.getElementById(contentId);

            if (!contentElement) {
                console.error(`âŒ æ‰¾ä¸åˆ°å…§å®¹å…ƒç´ : ${contentId}`);
                return;
            }

            // éš±è—placeholder
            const placeholder = contentElement.querySelector('.accordion-placeholder');
            if (placeholder) {
                placeholder.style.display = 'none';
            }

            // æª¢æŸ¥æ˜¯å¦æœ‰æ•¸æ“šå¯ç”¨
            const hasGoldData = goldPriceData && Object.keys(goldPriceData).length > 0;
            const hasMarketData = marketData && Object.keys(marketData).length > 0;

            switch (accordionId) {
                case 'system-info-accordion':
                    updateSystemInfoContent(contentElement);
                    break;
                case 'gold-price-accordion':
                    if (hasGoldData) {
                        updateGoldPriceContent(contentElement);
                    } else {
                        contentElement.innerHTML = `
                            <div class="log-content">
                                <p><strong>ç‹€æ…‹:</strong> <span class="status-warning">ç­‰å¾…æ•¸æ“šè¼‰å…¥...</span></p>
                                <p>è«‹å…ˆè¼‰å…¥é»ƒé‡‘åƒ¹æ ¼æ•¸æ“š</p>
                            </div>
                        `;
                    }
                    break;
                case 'technical-indicators-accordion':
                    if (hasGoldData && goldPriceData.technical_indicators) {
                        updateTechnicalIndicatorsContent(contentElement);
                    } else {
                        contentElement.innerHTML = `
                            <div class="log-content">
                                <p><strong>ç‹€æ…‹:</strong> <span class="status-warning">ç­‰å¾…æ•¸æ“šè¼‰å…¥...</span></p>
                                <p>è«‹å…ˆè¼‰å…¥é»ƒé‡‘åƒ¹æ ¼æ•¸æ“š</p>
                            </div>
                        `;
                    }
                    break;
                case 'market-sentiment-accordion':
                    if (hasMarketData) {
                        updateMarketSentimentContent(contentElement);
                    } else {
                        contentElement.innerHTML = `
                            <div class="log-content">
                                <p><strong>ç‹€æ…‹:</strong> <span class="status-warning">ç­‰å¾…æ•¸æ“šè¼‰å…¥...</span></p>
                                <p>è«‹å…ˆè¼‰å…¥å¸‚å ´æƒ…æ„Ÿåˆ†ææ•¸æ“š</p>
                            </div>
                        `;
                    }
                    break;
                case 'chart-data-accordion':
                    if (hasGoldData && goldPriceData.chart_data && goldPriceData.chart_data.length > 0) {
                        updateChartDataContent(contentElement);
                    } else {
                        contentElement.innerHTML = `
                            <div class="log-content">
                                <p><strong>ç‹€æ…‹:</strong> <span class="status-warning">ç­‰å¾…æ•¸æ“šè¼‰å…¥...</span></p>
                                <p>è«‹å…ˆè¼‰å…¥é»ƒé‡‘åƒ¹æ ¼åœ–è¡¨æ•¸æ“š</p>
                            </div>
                        `;
                    }
                    break;
                case 'yearly-stats-accordion':
                    if (hasGoldData && goldPriceData.chart_data && goldPriceData.chart_data.length > 0) {
                        updateYearlyStatsContent(contentElement);
                    } else {
                        contentElement.innerHTML = `
                            <div class="log-content">
                                <p><strong>ç‹€æ…‹:</strong> <span class="status-warning">ç­‰å¾…æ•¸æ“šè¼‰å…¥...</span></p>
                                <p>è«‹å…ˆè¼‰å…¥é»ƒé‡‘åƒ¹æ ¼å¹´åº¦æ•¸æ“š</p>
                            </div>
                        `;
                    }
                    break;
                default:
                    console.warn(`âš ï¸ æœªçŸ¥çš„ accordion ID: ${accordionId}`);
            }
        }



        function toggleMarketContent() {
            const content = document.getElementById('market-content');
            const isExpanded = content.style.maxHeight === 'none';

            content.style.maxHeight = isExpanded ? '200px' : 'none';
            content.style.overflow = isExpanded ? 'hidden' : 'visible';

            const btn = content.nextElementSibling;
            if (btn && btn.classList.contains('expand-btn')) {
                btn.textContent = isExpanded ? 'å±•é–‹å…¨æ–‡' : 'æ”¶èµ·';
            }
        }

        function toggleEmailReportContent() {
            const content = document.getElementById('email-report-content');
            const isExpanded = content.style.maxHeight === 'none';

            content.style.maxHeight = isExpanded ? '300px' : 'none';
            content.style.overflow = isExpanded ? 'hidden' : 'visible';

            const btn = content.nextElementSibling;
            if (btn && btn.classList.contains('expand-btn')) {
                btn.textContent = isExpanded ? 'å±•é–‹å…¨æ–‡' : 'æ”¶èµ·';
            }
        }

        // ===== Accordion å…§å®¹æ›´æ–°å‡½æ•¸ =====
        function updateSystemInfoContent(contentElement) {
            contentElement.innerHTML = `
                <div class="log-content">
                    <p><strong>ç³»çµ±æ™‚é–“:</strong> ${new Date().toLocaleString('zh-TW')}</p>
                    <p><strong>æ•¸æ“šä¾†æº:</strong> Yahoo Finance</p>
                    <p><strong>APIç‹€æ…‹:</strong> <span class="status-success">æ­£å¸¸</span></p>
                    <p><strong>ä¸‹æ¬¡æ›´æ–°:</strong> ${document.getElementById('next-update').textContent}</p>
                    <p><strong>ç³»çµ±ç‰ˆæœ¬:</strong> v2.1.4</p>
                </div>
            `;
        }

        function updateGoldPriceContent(contentElement) {
            if (!goldPriceData) return;

            contentElement.innerHTML = `
                <div class="log-content">
                    <p><strong>ä»£ç¢¼:</strong> ${goldPriceData.symbol || 'GC=F'}</p>
                    <p><strong>åç¨±:</strong> ${goldPriceData.name || 'Gold Futures'}</p>
                    <p><strong>ç•¶å‰åƒ¹æ ¼:</strong> ${goldPriceData.current_price?.toFixed(2) || 'N/A'}</p>
                    <p><strong>è®ŠåŒ–é‡‘é¡:</strong> ${goldPriceData.change >= 0 ? '+' : ''}${goldPriceData.change?.toFixed(2) || 'N/A'}</p>
                    <p><strong>è®ŠåŒ–ç™¾åˆ†æ¯”:</strong> ${goldPriceData.change_percent >= 0 ? '+' : ''}${goldPriceData.change_percent?.toFixed(2) || 'N/A'}%</p>
                    <p><strong>ç•¶æ—¥é«˜:</strong> ${goldPriceData.today_high?.toFixed(2) || 'N/A'}</p>
                    <p><strong>ç•¶æ—¥ä½:</strong> ${goldPriceData.today_low?.toFixed(2) || 'N/A'}</p>
                    <p><strong>å¹´å¹³å‡åƒ¹æ ¼:</strong> ${goldPriceData.avg_price?.toFixed(2) || 'N/A'}</p>
                    <p><strong>å¹´æ¨™æº–å·®:</strong> ${goldPriceData.volatility?.toFixed(2) || 'N/A'}</p>
                    <p><strong>å¸‚å ´ç‹€æ…‹:</strong> ${getMarketStatusText(goldPriceData.market_status)}</p>
                    <p><strong>è²¨å¹£å–®ä½:</strong> ${goldPriceData.currency || 'USD'}</p>
                    <p><strong>æ•¸æ“šé»æ•¸é‡:</strong> ${goldPriceData.data_points || 0}</p>
                    <p><strong>äº¤æ˜“å¤©æ•¸:</strong> ${goldPriceData.trading_days || 0}</p>
                    <p><strong>æ™‚é–“æœŸé–“:</strong> ä¸€å¹´</p>
                    <p><strong>æ™‚é–“é–“éš”:</strong> ${goldPriceData.interval || '1d'}</p>
                    <p><strong>æœ€å¾Œæ›´æ–°:</strong> ${goldPriceData.last_updated_formatted || (goldPriceData.last_updated ? new Date(goldPriceData.last_updated).toLocaleString('zh-TW') : 'æœªçŸ¥')}</p>
                </div>
            `;
        }

        function updateTechnicalIndicatorsContent(contentElement) {
            if (!goldPriceData?.technical_indicators) return;

            const indicators = goldPriceData.technical_indicators;
            contentElement.innerHTML = `
                <div class="log-content">
                    ${indicators.ma_5 ? `<p><strong>MA5 (5æ—¥ç§»å‹•å¹³å‡):</strong> ${indicators.ma_5.toFixed(2)}</p>` : ''}
                    ${indicators.ma_20 ? `<p><strong>MA20 (20æ—¥ç§»å‹•å¹³å‡):</strong> ${indicators.ma_20.toFixed(2)}</p>` : ''}
                    ${indicators.ma_50 ? `<p><strong>MA50 (50æ—¥ç§»å‹•å¹³å‡):</strong> ${indicators.ma_50.toFixed(2)}</p>` : ''}
                    ${indicators.rsi ? `<p><strong>RSI (ç›¸å°å¼·å¼±æŒ‡æ¨™):</strong> ${indicators.rsi.toFixed(1)} ${getRSIStatus(indicators.rsi)}</p>` : ''}
                    ${indicators.volatility_5d ? `<p><strong>5æ—¥æ³¢å‹•ç‡:</strong> ${indicators.volatility_5d.toFixed(2)}</p>` : ''}
                    ${indicators.price_vs_ma20 ? `<p><strong>åƒ¹æ ¼ç›¸å°MA20:</strong> ${indicators.price_vs_ma20 >= 0 ? '+' : ''}${indicators.price_vs_ma20.toFixed(2)}%</p>` : ''}
                </div>
            `;
        }

        function updateMarketSentimentContent(contentElement) {
            if (!marketData) return;

            // ç²å– score - ä½¿ç”¨èˆ‡æœ€ä¸Šé¢å¸‚å ´æƒ…æ„Ÿåˆ†æç›¸åŒçš„é‚è¼¯
            let sentimentScore = 0;

            // å¾ raw_data ä¸­ç²å– score
            if (marketData.raw_data && marketData.raw_data.score !== undefined) {
                sentimentScore = marketData.raw_data.score;
            } else if (marketData.average_sentiment_score !== undefined) {
                sentimentScore = marketData.average_sentiment_score;
            }

            // å°‡ -1 åˆ° 1 çš„ç¯„åœè½‰æ›ç‚º 0 åˆ° 100 çš„ç¯„åœ
            // 0 = æ¥µåº¦ææ…Œ, 100 = æ¥µåº¦è²ªå©ª
            if (sentimentScore >= -1 && sentimentScore <= 1) {
                sentimentScore = Math.round(((sentimentScore + 1) / 2) * 100);
            }

            // ç²å–æƒ…æ„Ÿç›¸é—œä¿¡æ¯
            const sentimentClass = getSentimentClass(sentimentScore);
            const sentimentText = getSentimentText(sentimentScore);
            const sentimentEmoji = getSentimentEmoji(sentimentScore);



            contentElement.innerHTML = `
                <div class="log-content">
                    <div class="sentiment-details">
                        <div class="sentiment-header">
                            <span class="sentiment-emoji">${sentimentEmoji}</span>
                            <span class="sentiment-score">${sentimentScore}/100åˆ†</span>
                            <span class="sentiment-text sentiment-${sentimentClass}">${sentimentText}</span>
                        </div>
                        
                        <div class="market-details">
                            <p><strong>å¸‚å ´æ—¥æœŸ:</strong> ${marketData.market_date || 'æœªçŸ¥'}</p>
                            <p><strong>æ¥æ”¶æ™‚é–“:</strong> ${marketData.received_time || 'æœªçŸ¥'}</p>
                        </div>
                        
                        <div class="analysis-section">
                            <p><strong>å¸‚å ´æƒ…ç·’æ‘˜è¦:</strong></p>
                            <div class="analysis-content">
                                <p>${getSummaryContent(marketData)}</p>
                            </div>
                        </div>
                </div>
            `;
        }

        function updateChartDataContent(contentElement) {
            if (!goldPriceData?.chart_data || goldPriceData.chart_data.length === 0) return;

            const chartData = goldPriceData.chart_data;
            const sampleSize = Math.min(5, chartData.length);
            const samples = chartData.slice(-sampleSize);

            contentElement.innerHTML = `
                <div class="log-content">
                    <div class="data-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>æ™‚é–“</th>
                                    <th>é–‹ç›¤</th>
                                    <th>æœ€é«˜</th>
                                    <th>æœ€ä½</th>
                                    <th>æ”¶ç›¤</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${samples.map(point => `
                                    <tr>
                                        <td>${new Date(point.time).toLocaleDateString('zh-TW')}</td>
                                        <td>${point.open?.toFixed(2) || 'N/A'}</td>
                                        <td>${point.high?.toFixed(2) || 'N/A'}</td>
                                        <td>${point.low?.toFixed(2) || 'N/A'}</td>
                                        <td>${point.price?.toFixed(2) || 'N/A'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }



        function updateYearlyStatsContent(contentElement) {
            if (!goldPriceData?.chart_data || goldPriceData.chart_data.length === 0) return;

            const chartData = goldPriceData.chart_data;
            const prices = chartData.map(d => d.price).filter(p => p && !isNaN(p));

            contentElement.innerHTML = `
                <div class="log-content">
                    <p><strong>ç¸½æ•¸æ“šé»æ•¸:</strong> ${chartData.length}</p>
                    <p><strong>æœ‰æ•ˆåƒ¹æ ¼æ•¸æ“š:</strong> ${prices.length}</p>
                    <p><strong>åƒ¹æ ¼ç¯„åœ:</strong> ${Math.min(...prices).toFixed(2)} - ${Math.max(...prices).toFixed(2)}</p>
                    <p><strong>å¹´åº¦å¹³å‡åƒ¹æ ¼:</strong> ${(prices.reduce((a, b) => a + b, 0) / prices.length).toFixed(2)}</p>
                    <p><strong>å¹´åº¦åƒ¹æ ¼æ¨™æº–å·®:</strong> ${calculateStandardDeviation(prices).toFixed(2)}</p>
                    <p><strong>æ•¸æ“šèµ·å§‹æ—¥æœŸ:</strong> ${new Date(chartData[0].time).toLocaleDateString('zh-TW')}</p>
                    <p><strong>æ•¸æ“šçµæŸæ—¥æœŸ:</strong> ${new Date(chartData[chartData.length - 1].time).toLocaleDateString('zh-TW')}</p>
                    <p><strong>å¹´åº¦æ¼²è·Œ:</strong> ${((prices[prices.length - 1] - prices[0]) / prices[0] * 100).toFixed(2)}%</p>
                </div>
            `;
        }

        // ===== è¼”åŠ©å‡½æ•¸ =====
        function getSummaryContent(data) {
            // å¾ raw_data ä¸­ç²å– summary
            if (data.raw_data && data.raw_data.summary) {
                return data.raw_data.summary;
            } else if (data.summary) {
                return data.summary;
            } else if (data.message_content) {
                return data.message_content;
            }
            return 'ç„¡åˆ†æå…§å®¹';
        }

        function getSentimentClass(score) {
            if (score >= 76) return 'positive';
            if (score >= 51) return 'positive';
            if (score === 50) return 'neutral';
            if (score >= 26) return 'negative';
            return 'negative';
        }

        function getSentimentText(score) {
            if (score >= 76) return 'æ¥µåº¦è²ªå©ª';
            if (score >= 51) return 'è²ªå©ª';
            if (score === 50) return 'ä¸­ç«‹';
            if (score >= 26) return 'ææ‡¼';
            return 'æ¥µåº¦ææ‡¼';
        }

        function getSentimentEmoji(score) {
            if (score >= 76) return 'ğŸ˜ˆ';
            if (score >= 51) return 'ğŸ˜';
            if (score === 50) return 'ğŸ˜';
            if (score >= 26) return 'ğŸ˜°';
            return 'ğŸ˜±';
        }

        function getMarketStatusText(status) {
            const statusMap = {
                'open': 'é–‹å¸‚',
                'closed': 'ä¼‘å¸‚',
                'unknown': 'æœªçŸ¥'
            };
            return statusMap[status] || status;
        }

        function getRSIStatus(rsi) {
            if (rsi > 70) return '(è¶…è²·)';
            if (rsi < 30) return '(è¶…è³£)';
            return '(æ­£å¸¸)';
        }

        function calculateStandardDeviation(values) {
            const avg = values.reduce((a, b) => a + b) / values.length;
            const squareDiffs = values.map(value => Math.pow(value - avg, 2));
            const avgSquareDiff = squareDiffs.reduce((a, b) => a + b) / squareDiffs.length;
            return Math.sqrt(avgSquareDiff);
        }

        // ===== å¿«é€Ÿæ“ä½œå‡½æ•¸ =====
        function scrollToGoldPrice() {
            console.log('ğŸ¯ è·³è½‰åˆ°é»ƒé‡‘åƒ¹æ ¼å€å¡Š');
            const goldSection = document.getElementById('gold-price-section');
            if (goldSection) {
                goldSection.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            } else {
                console.error('âŒ æ‰¾ä¸åˆ°é»ƒé‡‘åƒ¹æ ¼å€å¡Š');
            }
        }

        function scrollToSentiment() {
            console.log('ğŸ¯ è·³è½‰åˆ°å¸‚å ´æƒ…æ„Ÿåˆ†æå€å¡Š');
            const sentimentSection = document.getElementById('sentiment-section');
            if (sentimentSection) {
                sentimentSection.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            } else {
                console.error('âŒ æ‰¾ä¸åˆ°å¸‚å ´æƒ…æ„Ÿåˆ†æå€å¡Š');
            }
        }

        function scrollToDataDetails() {
            console.log('ğŸ¯ è·³è½‰åˆ°è©³ç´°æ•¸æ“šæ—¥èªŒå€å¡Š');
            const dataLogsSection = document.getElementById('data-logs-section');
            if (dataLogsSection) {
                dataLogsSection.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            } else {
                console.error('âŒ æ‰¾ä¸åˆ°è©³ç´°æ•¸æ“šæ—¥èªŒå€å¡Š');
            }
        }

        function toggleTechnicalIndicators() {
            console.log('ğŸ“Š åˆ‡æ›æŠ€è¡“æŒ‡æ¨™é¡¯ç¤º');
            const indicators = document.getElementById('technical-indicators');
            const enhancedSignals = document.getElementById('enhanced-signal-display');
            const toggleBtn = document.getElementById('technical-toggle');

            if (indicators && enhancedSignals && toggleBtn) {
                const isVisible = indicators.style.display !== 'none';

                if (isVisible) {
                    indicators.style.display = 'none';
                    enhancedSignals.style.display = 'none';
                    toggleBtn.querySelector('span').textContent = 'é¡¯ç¤ºæŠ€è¡“æŒ‡æ¨™';
                } else {
                    indicators.style.display = 'block';
                    enhancedSignals.style.display = 'block';
                    toggleBtn.querySelector('span').textContent = 'éš±è—æŠ€è¡“æŒ‡æ¨™';
                }
            } else {
                console.error('âŒ æ‰¾ä¸åˆ°æŠ€è¡“æŒ‡æ¨™å…ƒç´ ');
            }
        }

        function toggleDataDetails() {
            console.log('ğŸ“‹ åˆ‡æ›è©³ç´°æ•¸æ“šæ—¥èªŒé¡¯ç¤º');
            const toggleBtn = document.getElementById('details-toggle');

            if (toggleBtn) {
                const isShowingData = toggleBtn.querySelector('span').textContent === 'éš±è—è©³æƒ…';

                if (isShowingData) {
                    // éš±è—æ•¸æ“šï¼Œé¡¯ç¤ºplaceholder
                    toggleBtn.querySelector('span').textContent = 'é¡¯ç¤ºè©³æƒ…';

                    // æ”¶åˆæ‰€æœ‰accordioné …ç›®ä¸¦é¡¯ç¤ºplaceholder
                    const accordionItems = document.querySelectorAll('.accordion-content');
                    accordionItems.forEach(content => {
                        content.style.display = 'none';
                        content.classList.remove('expanded');

                        // æ¢å¾©placeholderå…§å®¹
                        const placeholder = content.querySelector('.accordion-placeholder');
                        if (placeholder) {
                            placeholder.style.display = 'block';
                        }
                    });

                    // é‡ç½®æ‰€æœ‰accordionåœ–æ¨™
                    const accordionIcons = document.querySelectorAll('.accordion-icon');
                    accordionIcons.forEach(icon => {
                        icon.classList.remove('fa-minus');
                        icon.classList.add('fa-plus');
                    });

                } else {
                    // é¡¯ç¤ºæ•¸æ“š
                    toggleBtn.querySelector('span').textContent = 'éš±è—è©³æƒ…';

                    // è‡ªå‹•å±•é–‹æ‰€æœ‰accordioné …ç›®ä¸¦è¼‰å…¥æ•¸æ“š
                    const accordionIds = [
                        'system-info-accordion',
                        'gold-price-accordion',
                        'technical-indicators-accordion',
                        'market-sentiment-accordion',
                        'chart-data-accordion',
                        'yearly-stats-accordion'
                    ];

                    accordionIds.forEach((accordionId, index) => {
                        setTimeout(() => {
                            const accordion = document.getElementById(accordionId);
                            if (accordion) {
                                const content = accordion.querySelector('.accordion-content');
                                const icon = accordion.querySelector('.accordion-icon');

                                if (content && icon) {
                                    // å±•é–‹accordion
                                    content.style.display = 'block';
                                    content.classList.add('expanded');
                                    icon.classList.remove('fa-plus');
                                    icon.classList.add('fa-minus');

                                    // éš±è—placeholder
                                    const placeholder = content.querySelector('.accordion-placeholder');
                                    if (placeholder) {
                                        placeholder.style.display = 'none';
                                    }

                                    // è¼‰å…¥å°æ‡‰çš„æ•¸æ“š
                                    updateAccordionContent(accordionId);
                                }
                            }
                        }, index * 200); // æ¯å€‹accordioné–“éš”200mså±•é–‹ï¼Œå‰µé€ å‹•ç•«æ•ˆæœ
                    });
                }
            } else {
                console.error('âŒ æ‰¾ä¸åˆ°è©³ç´°æ•¸æ“šæ—¥èªŒæŒ‰éˆ•');
            }
        }

        async function refreshAllData() {
            console.log('ğŸ”„ é–‹å§‹åˆ·æ–°æ‰€æœ‰æ•¸æ“š...');

            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            const refreshBtn = document.getElementById('refresh-btn');
            if (refreshBtn) {
                const originalText = refreshBtn.querySelector('span').textContent;
                refreshBtn.querySelector('span').textContent = 'åˆ·æ–°ä¸­...';
                refreshBtn.disabled = true;

                try {
                    // ä¸¦è¡Œåˆ·æ–°æ•¸æ“š
                    await Promise.all([
                        loadMarketData(),
                        loadGoldPrice(currentPeriod, true)
                    ]);

                    console.log('âœ… æ‰€æœ‰æ•¸æ“šåˆ·æ–°å®Œæˆ');
                } catch (error) {
                    console.error('âŒ æ•¸æ“šåˆ·æ–°å¤±æ•—:', error);
                } finally {
                    // æ¢å¾©æŒ‰éˆ•ç‹€æ…‹
                    refreshBtn.querySelector('span').textContent = originalText;
                    refreshBtn.disabled = false;
                }
            }
        }

        // ===== ç‹€æ…‹æ›´æ–°å‡½æ•¸ =====
        function updateMarketStatus(status, text) {
            const dot = document.querySelector('#status-indicator .indicator-dot');
            const textElement = document.querySelector('#status-indicator .indicator-text');

            if (dot && textElement) {
                dot.classList.remove('connected', 'error', 'loading');
                if (status !== 'waiting') {
                    dot.classList.add(status);
                }
                textElement.textContent = text;
            }
        }

        function updatePriceStatus(status, text) {
            const dot = document.querySelector('#price-status .status-dot');
            const textElement = document.querySelector('#price-status .status-text');

            if (dot && textElement) {
                dot.classList.remove('connected', 'error', 'loading');
                if (status !== 'waiting') {
                    dot.classList.add(status);
                }
                textElement.textContent = text;
            }
        }

        function updateGoldLastUpdated(text) {
            const element = document.getElementById('gold-last-updated');
            if (element) {
                element.querySelector('span').textContent = text;
            }
        }

        // ===== è¼‰å…¥å’ŒéŒ¯èª¤é¡¯ç¤ºå‡½æ•¸ =====
        function showPriceLoading() {
            const display = document.getElementById('price-display');
            display.innerHTML = `
                <div class="loading-spinner">
                    <div class="spinner"></div>
                    <span>æ­£åœ¨è¼‰å…¥é»ƒé‡‘åƒ¹æ ¼...</span>
                </div>
            `;
        }

        function displayNoMarketData() {
            const display = document.getElementById('market-data-display');
            display.innerHTML = `
                <div class="no-data">
                    <i class="fas fa-chart-bar"></i>
                    <h3>ç­‰å¾…å¸‚å ´æ•¸æ“š</h3>
                    <p>è«‹ç¢ºèª N8N å·¥ä½œæµç¨‹å·²æ­£ç¢ºé‹è¡Œä¸¦ç™¼é€æ•¸æ“š</p>
                    <button onclick="loadMarketData()" class="retry-btn">
                        <i class="fas fa-refresh"></i>
                        é‡æ–°è¼‰å…¥
                    </button>
                </div>
            `;
        }

        function displayMarketError(message) {
            const display = document.getElementById('market-data-display');
            display.innerHTML = `
                <div class="error-state">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>æ•¸æ“šè¼‰å…¥å¤±æ•—</h3>
                    <p>${message}</p>
                    <button onclick="loadMarketData()" class="retry-btn">
                        <i class="fas fa-refresh"></i>
                        é‡è©¦
                    </button>
                </div>
            `;
        }

        function displayPriceError(message) {
            const display = document.getElementById('price-display');
            display.innerHTML = `
                <div class="error-state">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>åƒ¹æ ¼è¼‰å…¥å¤±æ•—</h3>
                    <p>${message}</p>
                    <button onclick="loadGoldPrice(currentPeriod, true)" class="retry-btn">
                        <i class="fas fa-refresh"></i>
                        é‡è©¦
                    </button>
                </div>
            `;
        }

        // ===== éŒ¯èª¤è™•ç† =====
        window.addEventListener('error', (e) => {
            console.error('JavaScript éŒ¯èª¤:', e.error);
        });

        window.addEventListener('unhandledrejection', (e) => {
            console.error('æœªè™•ç†çš„ Promise æ‹’çµ•:', e.reason);
        });

        console.log('âœ… å¸‚å ´åˆ†æç³»çµ±è…³æœ¬è¼‰å…¥å®Œæˆ');
    </script>

    <style>
        /* å¼·åˆ¶Xè»¸æ¨™ç±¤æ°´å¹³é¡¯ç¤º */
        .chart-container canvas {
            transform: none !important;
        }

        /* å¼·åˆ¶åœ–è¡¨æ¨™ç±¤æ°´å¹³é¡¯ç¤º */
        .chart-container {
            overflow: visible !important;
        }

        /* ç¢ºä¿Xè»¸æ¨™ç±¤ä¸æ—‹è½‰ */
        .chart-container canvas {
            transform: none !important;
        }

        /* è©³ç´°æ—¥èªŒæ¨£å¼ */
        .data-details-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            transition: var(--transition);
        }

        .log-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: var(--bg-glass);
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        .log-section h4 {
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .log-content {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .log-content p {
            margin-bottom: 0.5rem;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
        }

        .log-content strong {
            color: var(--text-primary);
        }

        .status-success {
            color: var(--success);
            font-weight: bold;
        }

        .status-warning {
            color: #f59e0b;
            font-weight: bold;
        }

        .data-table {
            overflow-x: auto;
            margin-top: 1rem;
        }

        .data-table table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.85rem;
        }

        .data-table th,
        .data-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .data-table th {
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-weight: bold;
        }

        .data-table td {
            color: var(--text-secondary);
        }

        .data-table tr:hover {
            background: var(--bg-glass);
        }

        .data-table .positive {
            color: var(--success);
            font-weight: bold;
        }

        .data-table .negative {
            color: var(--error);
            font-weight: bold;
        }

        /* ç·šæ¢æ§åˆ¶æ¨£å¼ */
        .line-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .line-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--radius);
            background: var(--bg-glass);
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        .line-toggle:hover {
            background: var(--bg-secondary);
            border-color: var(--primary);
        }

        .line-toggle input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: var(--primary);
        }

        .toggle-label {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .data-table {
                font-size: 0.8rem;
            }

            .data-table th,
            .data-table td {
                padding: 0.5rem;
            }

            .line-controls {
                gap: 0.5rem;
            }

            .line-toggle {
                padding: 0.25rem 0.5rem;
                font-size: 0.8rem;
            }
        }

        /* å¼·åˆ¶Xè»¸æ¨™ç±¤æ°´å¹³é¡¯ç¤º */
        .chart-container canvas {
            transform: none !important;
        }

        /* äº¤å‰ä¿¡è™Ÿé¡¯ç¤ºæ¨£å¼ */
        .cross-signal-display {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: var(--bg-glass);
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        .cross-signal-display h3 {
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .signal-content {
            display: grid;
            gap: 1rem;
        }

        .signal-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: var(--bg-secondary);
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        .signal-label {
            font-weight: 600;
            color: var(--text-primary);
        }

        .signal-value {
            font-weight: bold;
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius);
            font-size: 0.9rem;
        }

        .signal-golden {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .signal-death {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .signal-normal {
            background: rgba(100, 116, 139, 0.2);
            color: #64748b;
            border: 1px solid rgba(100, 116, 139, 0.3);
        }

        .signal-message-text {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.4;
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .signal-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
        }

        /* Accordion æ¨£å¼ */
        .accordion-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .accordion-item {
            background: var(--bg-glass);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
            transition: var(--transition);
        }

        .accordion-item:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
        }

        .accordion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            background: var(--bg-secondary);
            cursor: pointer;
            user-select: none;
            transition: var(--transition);
        }

        .accordion-header:hover {
            background: var(--bg-glass);
        }

        .accordion-header span {
            color: var(--text-primary);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .accordion-icon {
            color: var(--text-secondary);
            transition: var(--transition);
        }

        /* ä¿®å¾©accordionå±•é–‹/æ”¶åˆå‹•ç•« */
        .accordion-content {
            display: none;
            padding: 1.5rem;
            background: var(--bg-glass);
            border-top: 1px solid var(--border);
            overflow: hidden;
            transition: all 0.3s ease-in-out;
        }

        .accordion-content.expanded {
            display: block !important;
        }

        .accordion-placeholder {
            text-align: center;
            color: var(--text-muted);
            font-style: italic;
            padding: 2rem;
        }

        /* ä¸»ä½ˆå±€æ¨£å¼ */
        .main-layout {
            display: flex;
            gap: 2rem;
            margin-top: 2rem;
        }

        .sidebar {
            position: sticky;
            top: 2rem;
            width: 280px;
            flex-shrink: 0;
            height: fit-content;
        }

        .quick-actions-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            transition: var(--transition);
        }

        .quick-actions-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        .quick-actions-card .card-header {
            padding: 1.5rem;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .quick-actions-card .card-header h3 {
            margin: 0;
            color: var(--text-primary);
            font-size: 1.1rem;
            font-weight: 600;
        }

        .quick-actions-card .card-content {
            padding: 1.5rem;
        }

        .action-buttons-vertical {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .action-buttons-vertical .action-btn {
            width: 100%;
            justify-content: flex-start;
            padding: 1rem;
            font-size: 0.95rem;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 1024px) {
            .main-layout {
                flex-direction: column;
            }

            .sidebar {
                position: static;
                width: 100%;
                order: -1;
            }

            .quick-actions-card {
                margin-bottom: 1rem;
            }

            .action-buttons-vertical {
                flex-direction: row;
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .action-buttons-vertical .action-btn {
                flex: 1;
                min-width: 150px;
                padding: 0.75rem;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 768px) {
            .action-buttons-vertical {
                flex-direction: column;
            }

            .action-buttons-vertical .action-btn {
                width: 100%;
                min-width: auto;
            }
        }

        .status-warning {
            color: #f59e0b;
            font-weight: bold;
        }

        .analysis-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1rem;
            margin-top: 0.5rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .analysis-content p {
            margin: 0;
            line-height: 1.6;
            color: var(--text-secondary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .analysis-content::-webkit-scrollbar {
            width: 6px;
        }

        .analysis-content::-webkit-scrollbar-track {
            background: var(--bg-glass);
            border-radius: 3px;
        }

        .analysis-content::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        .analysis-content::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* Email Report å…§å®¹æ¨£å¼ */
        .email-report-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1rem;
            margin-top: 0.5rem;
            max-height: 300px;
            overflow-y: auto;
            line-height: 1.6;
            color: var(--text-secondary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .email-report-content::-webkit-scrollbar {
            width: 6px;
        }

        .email-report-content::-webkit-scrollbar-track {
            background: var(--bg-glass);
            border-radius: 3px;
        }

        .email-report-content::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        .email-report-content::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* å¸‚å ´åˆ†æå ±å‘Šæ¨™é¡Œæ¨£å¼ */
        .email-report-content h2 {
            color: var(--text-primary);
            margin-bottom: 1rem;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .email-report-content h3 {
            color: var(--text-primary);
            margin: 1rem 0 0.5rem 0;
            font-size: 1rem;
            font-weight: 600;
        }

        .email-report-content p {
            margin: 0.5rem 0;
            line-height: 1.6;
        }

        .email-report-content ul {
            margin: 0.5rem 0;
            padding-left: 1.5rem;
        }

        .email-report-content li {
            margin: 0.25rem 0;
        }

        .email-report-content hr {
            border: none;
            border-top: 1px solid var(--border);
            margin: 1rem 0;
        }

        .email-report-content strong {
            color: var(--text-primary);
            font-weight: 600;
        }
    </style>
</body>

</html>
